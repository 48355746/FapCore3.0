/*! crowdtest */
crowdtestModule.factory("User",["$http","$q","$rootScope","$interval",function(a,b,c,d){function e(){this.currentUser=null}var f=b.defer();return e.prototype.setCurrentUser=function(a){this.currentUser=a,f.resolve(this.currentUser)},e.prototype.ready=function(){return f.promise},e.prototype.getCurrentUser=function(){return this.currentUser},e.prototype.updateCurrentUser=function(){var c=b.defer(),d=this,e=(new Date).getTime();return a.get(baseUrl+"crowdtest/project/getUserInfoJson?processTime="+e).success(function(a){parseInt(d.currentUser.gift_score,10),parseInt(a.gift_score,10);d.currentUser=a,c.resolve(d.currentUser)}),c.promise},c.User=new e,c.User}]),crowdtestModule.controller("UserReportController",["$scope","$rootScope",function(a,b){a.report=function(){var a=(new Date).getTime();$.get("/crowdtest/mission/statistics?name=sign-in-report&processTime="+a),seajs.use("popups/newCheckInPop",function(a){a.init({missionType:1,currentUser:b.User.currentUser,checkDays:b.User.currentUser.report.continueDay,awards:b.User.currentUser.signInAwards})})},a.award=function(){var a=(new Date).getTime();$.get("/crowdtest/mission/statistics?name=sign-in-award&processTime="+a),seajs.use("popups/newCheckInAwardPop",function(a){a.init({checkDays:b.User.currentUser.report.continueDay})})},a.finish=function(){var a=(new Date).getTime();$.get("/crowdtest/mission/statistics?name=sign-in-finish&processTime="+a),seajs.use("popups/newCheckInFinishPop",function(a){a.init({checkDays:b.User.currentUser.report.continueDay})})}}]),crowdtestModule.controller("AnnouncementController",["$scope",function(a){a.init=function(b){a.messages=b.famous_mes,a.adMessage=b.test_side_ad}}]),crowdtestModule.controller("EvaExperienceController",["$scope","$q","$http","$sce",function(a,b,c,d){var e=[{level:0,page_count:30,exp_reward:10,min_time:"一周",mark_level_cn:"初级快判师"},{level:1,page_count:60,exp_reward:15,min_time:"一周",mark_level_cn:"中级快判师"},{level:2,page_count:100,exp_reward:20,min_time:"一个月",mark_level_cn:"高级快判师"},{level:3,page_count:200,exp_reward:30,min_time:"",mark_level_cn:""}];a.init=function(f){a.isShow=!1,a.trustAsHtml=d.trustAsHtml,a.linkUrl="http://test.baidu.com/crowdtest/help/doc/id/217",a.titleLinkUrl="/crowdtest/home/titleList",a.userLinkUrl="/crowdtest/home/myExperience",f&&b.all([c.get("/crowdtest/title/getEvaTitleList"),c.get("/crowdtest/title/getUserEvaTitle"),c.get("/crowdtest/title/getUserExperience"),c.get("/crowdtest/title/getUserExpDayTaskInfo")]).then(function(b){a.isShow=!0;var c=b[0].data,d=b[1].data.userTitle,f=b[1].data.sidebarDisplay,g=b[2].data,h=b[3].data;d&&d.title?(a.evaTitleImgUrl=d.title.img_url,a.evaTitleDesc='若经验值减少, 称号可能被收回, <a href="'+a.linkUrl+'" target="_blank">点击了解</a>'):(a.evaTitleImgUrl="/crowdtest/images/title/set/eva_default.png",a.evaTitleDesc="想要获得此称号么? 快快累积经验值吧~");var i=null;if(angular.forEach(c,function(a){a.total_process=parseInt(a.total_process,10),!i&&a.total_process>g.eva_experience&&(i=a)}),a.nextTitle=i,a.userProcess=i?100*g.eva_experience/i.total_process:100,a.userExperience=g,a.titleLevel=h.level-1,a.pageCount=e[a.titleLevel].page_count,a.userExpDayTaskInfo=h,a.userExpDayTaskInfo.page_count>a.pageCount&&(a.userExpDayTaskInfo.page_count=a.pageCount),f){var j='恭喜您通过不懈的努力，获得了“<span style="color: #e63837;">'+d.title.title_name+"</span>”的称号!";seajs.use("popups/survey/userAttributeBubble",function(a){var b=(new Date).getTime();$.get("/crowdtest/mission/statistics?name=sidebar-title&param="+d.title_id+"&processTime="+b),a.show($(".experience-sidebar-wrap"),{content:j,top:"130px",left:"0px",height:" auto",width:$(".experience-sidebar-wrap").width()+"px",arrow:"up"})})}})},a.dayTaskNotice=function(){seajs.use("popups/expDayTaskNotice",function(b){b.show({expConfig:e[a.titleLevel]})})}}]),crowdtestModule.controller("surveyTitleController",["$scope","$q","$http","$sce",function(a,b,c,d){a.init=function(){a.trustAsHtml=d.trustAsHtml,a.titleLinkUrl="/crowdtest/home/titleList",a.isShow=!1,b.all([c.get("/crowdtest/title/getUserSurveyTitle"),c.get("/crowdtest/survey/userCreditAbnormalInfo")]).then(function(b){a.isShow=!0;var c=b[0].data,d=b[1].data.abnormalType;c.title?(a.surveyTitleImgUrl=c.title.img_url,a.surveyTitleDesc=c.title.sidebar_desc+',<a href="'+a.titleLinkUrl+'" target="_blank">点击了解</a>'):(a.surveyTitleImgUrl="/crowdtest/images/survey/intern.png",a.surveyTitleDesc='获得称号可解锁更多任务,<a href="'+a.titleLinkUrl+'" target="_blank">点击了解</a>'),1==d?a.surveyTitleDesc="发现作弊记录,请认真答卷,以免降级!":2==d?a.surveyTitleDesc="发现多次作弊记录,已降级,请认真答卷!":3==d?a.surveyTitleDesc="发现多次作弊记录,已降级,请认真答卷!":4==d&&(a.surveyTitleDesc="账号被标记作弊,不可参与问卷项目!")})}}]),window.crowdtestModule.controller("contractorEntranceController",["$scope","$http",function(a,b){a.init=function(){var c="/crowdtest/manualTest/getContractorProCount";b.get(c).success(function(b){0==b.errno&&(a.contractorPro=b.data)})}}]),crowdtestModule.directive("paginationList",function(){return{restrict:"EA",require:"?ngModel",scope:{totalItems:"=",firstText:"@",prevText:"@",nextText:"@",lastText:"@"},templateUrl:"pagination_list.html",link:function(a,b,c,d){function e(a,b){var c=5,d=Math.max(a-Math.floor((c-1)/2),1),e=d+c-1;e>b&&(e=b,d=Math.max(e-c+1,1));for(var f=[],g=d;g<=e;g++)f.push(g);return f}d.$render=function(){a.currentPage=parseInt(d.$viewValue,10)||1,a.pages=e(a.currentPage,a.totalPage)};var f={itemsPerPage:10,currentPage:1,isFirstLast:!1,isPrevNext:!0,firstText:"first",prevText:"prev",nextText:"next",lastText:"last"};a.isFirstLast=angular.isDefined(c.isFirstLast)?c.isFirstLast:f.isFirstLast,a.isPrevNext=angular.isDefined(c.isPrevNext)?c.isPrevNext:f.isPrevNext,a.$watch("totalItems",function(){a.itemsPerPage=angular.isDefined(c.itemsPerPage)?parseInt(c.itemsPerPage,10):f.itemsPerPage,a.totalPage=Math.ceil(a.totalItems/a.itemsPerPage),a.setPage(1)}),a.getText=function(a){return c[a+"Text"]||f[a+"Text"]},a.setPage=function(b){b>a.totalPage&&(b=a.totalPage),b<1&&(b=1),d.$setViewValue(b),d.$render()},a.isFirstPage=function(){return 1===a.currentPage},a.isLastPage=function(){return a.currentPage===a.totalPage},a.isActive=function(b){return a.currentPage===b}}}}),crowdtestModule.run(["$templateCache",function(a){var b='<ul class=pagination-list> <li ng-if=isFirstLast><a ng-bind="getText(\'first\')" ng-click="setPage(1)"></a> <li ng-if=isPrevNext><a ng-bind="getText(\'prev\')" ng-click="setPage(currentPage - 1)"></a> <li ng-repeat="page in pages"><a ng-class="{current: isActive(page)}" ng-bind=page ng-click="setPage(page)"></a> <li ng-if=isPrevNext><a ng-bind="getText(\'next\')" ng-click="setPage(currentPage + 1)"></a> <li ng-if=isFirstLast><a ng-bind="getText(\'last\')" ng-click="setPage(totalPage)"></a></ul>';a.put("pagination_list.html",b)}]),crowdtestModule.controller("testTitleProgressController",["Project","$scope",function(a,b){b.showTitle=!1,b.userTitleImg="",b.legionUserExperience=0,b.init=function(c){0===c.errno&&(b.leftImgUrl=c.data.title_info.left_url,b.rightImgUrl=c.data.title_info.right_url,b.experienceToUpGrade=c.data.title_info.next_title_experience-c.data.experience<0?0:c.data.title_info.next_title_experience-c.data.experience,b.title_name=c.data.title_info.next_title,b.leftExperienceRatio=c.data.experience/c.data.title_info.next_title_experience*100,parseInt(b.leftExperienceRatio,10)<0?b.leftExperienceRatio=0:parseInt(b.leftExperienceRatio,10)>100&&(b.leftExperienceRatio=100),b.totalReceive=null===c.data.score?0:c.data.score,b.filter=angular.extend({type:0,search:null,isLocked:!1}),b.totalItems=0,a.get(b.filter).then(function(a){b.totalItems=a.length,angular.forEach(a,function(a){0===parseInt(a.tester_status,10)&&(b.totalItems+=1)})}),$(".legion-title-progress-finish").css("width",b.leftExperienceRatio+"%"),0!==c.data.title_log.change_type&&(51===parseInt(c.data.title_log.title_id,10)&&1===(51===parseInt(c.data.title_log.title_id,10)&&parseInt(c.data.title_log.change_type))||seajs.use("popups/bug/titleExchange",function(a){a.show(parseInt(c.data.title_log.title_id,10),parseInt(c.data.title_log.change_type,10)).promise.then(function(){var a={user_id:parseInt(c.data.title_log.user_id,10),YII_CSRF_TOKEN:yii_csrf_token_global};$.post("/crowdtest/testLegion/modifyTitleChangeLog",a,function(){})})})))}}]),crowdtestModule.controller("MarkUserProfileController",["$scope","$q","$http","$sce",function(a,b,c,d){var e=["","初级快判师(待解锁)","初级快判师","中级快判师","高级快判师"],f=[0,0,300,600,6e3],g=["/crowdtest/images/mark_title/level1lock.png","/crowdtest/images/mark_title/level1lock.png","/crowdtest/images/mark_title/level1.png","/crowdtest/images/mark_title/level2.png","/crowdtest/images/mark_title/level3.png"],h=["/crowdtest/images/mark_title/level1.png","/crowdtest/images/mark_title/level1.png","/crowdtest/images/mark_title/level2to.png","/crowdtest/images/mark_title/level3to.png","/crowdtest/images/mark_title/badget.png"],i=["#eaeaea","#eaeaea","#f1f8ff","#fff7e2","#fff2f1"],j=["#aaaaaa","#aaaaaa","#b5d1f1","#ffbb78","#ff988e"],k=["rgb(27, 26, 26)","rgb(27, 26, 26)","rgb(43, 155, 252)","rgb(255, 126, 0)","rgb(230, 56, 55)"],l=["rgb(127, 127, 127)","rgb(127, 127, 127)","rgb(145, 178, 207)","rgb(255, 183, 58)","rgb(241, 156, 156)"];a.init=function(){c.get(baseUrl+"mark/task/getUserProfile").success(function(b){b.title_level=parseInt(b.title_level,10),a.user=b,a.user.level_img=g[b.title_level],a.user.next_level_img=h[b.title_level],a.user.current_level_cn=e[b.title_level],a.user.next_level_cn=b.title_level>=4?"":e[b.title_level+1],a.user.next_level_exp_delta=b.title_level>=4?0:f[b.title_level+1]-b.mark_exp,a.user.next_level_process=b.title_level>=4?100:Math.min(100,100*b.mark_exp/f[b.title_level+1]),a.css={height:b.title_level>=4?182:220,bg_color:i[b.title_level],bg_color2:j[b.title_level],imp_font_color:k[b.title_level],font_color:l[b.title_level]}})}}]),crowdtestModule.directive("myeditor",[function(){return{restrict:"E",replace:!0,template:'<div type="text/plain" id="editor" name="editor">',scope:{content:"=",option:"="},link:function(a,b,c){a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)};var d={1:[" undo redo |"," bold italic underline strikethrough forecolor | "," paragraph insertorderedlist insertunorderedlist |"," selectall cleardoc removeformat | "," image link unlink |"," fullscreen "],2:[" undo redo |"," bold | paragraph insertorderedlist insertunorderedlist |"," selectall cleardoc removeformat | "," image link unlink | "," fullscreen "],3:[" forecolor "," image"]};a.option.height=a.option.height?a.option.height:"184";var e=window.um=UM.getEditor("editor",{toolbar:d[a.option&&a.option.toolbarIndex?a.option.toolbarIndex:1],paragraph:{p:"",h1:"",h2:"",h5:""},initialFrameWidth:a.option.width?a.option.width:"100%",initialFrameHeight:a.option.height,focus:!1,imageUrl:"/crowdtest/file/umFileUpload",imagePath:""}),f=function(){!a.option||"edit"!==a.option.process||""!==a.content&&void 0!==a.content?(a.safeApply(),e.ready(function(){$(".edui-editor-body").prepend('<p id="edui-content-placeholder"></p>'),a.content?e.setContent(a.content):a.option&&a.option.placeholder&&$("#edui-content-placeholder").text(a.option.placeholder)}),e.addListener("contentChange",function(){a.content=e.getContent(),a.safeApply(),a.option&&a.option.placeholder&&(""!==e.getContentTxt()?$("#edui-content-placeholder").css("display","none"):$("#edui-content-placeholder").css("display","block"))}),e.addInputRule(function(a){a.traversal(function(a){a.setAttr("style","")})}),$("#editor").css("height",a.option.height+"px"),$(".edui-btn-name-paragraph").prepend('<span unselectable="on" onmousedown="return false" class="edui-button-label-placeholder">段落格式</span>'),$(".edui-btn-name-paragraph.edui-combobox").on("click",function(){$(".edui-combobox-item-0 .edui-combobox-item-label").html('<span style="color: #333333">p（正文）</span>'),$(".edui-combobox-item-1 .edui-combobox-item-label").html('<div style="font-size: 16px; color: #333333; font-weight: bold">h1（一级标题）</div>'),$(".edui-combobox-item-2 .edui-combobox-item-label").html('<span style="font-size: 14px; color: #333333; font-weight: bold">h2（二级标题）</span>'),$(".edui-combobox-item-3 .edui-combobox-item-label").html('<span style="font-size: 14px; color: #999999">n（注释）</span>'),$(".edui-combobox-item").click(function(){$(".edui-button-label-placeholder").text($(this).text())})}),$(".edui-editor-body").bind("keyup click",function(a){if("click"===a.type||13===a.keyCode||8===a.keyCode||46===a.keyCode||a.keyCode>36&&a.keyCode<41){var b=$(this).parents(".edui-container");setTimeout(function(){var a=b.find(".edui-button-label").text().trim();switch(a){case"h1":b.find(".edui-button-label-placeholder").text("h1（一级标题）");break;case"h2":b.find(".edui-button-label-placeholder").text("h2（二级标题）");break;case"h5":b.find(".edui-button-label-placeholder").text("n（注释）");break;default:b.find(".edui-button-label-placeholder").text("p（正文）")}},300)}})):setTimeout(function(){f()},100)};f()}}}]);