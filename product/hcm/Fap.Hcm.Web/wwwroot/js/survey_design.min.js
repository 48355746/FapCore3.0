function inArray(n,t){var i=!1;return $.each(t,function(t,r){if(r===n)return(i=!0,!1)}),i}function selectQuestion(n){var t='<div class="topic-type-content topic-type-question after-clear">',i=parseInt(absolute_id)+1,u,r;switch(absolute_id++,choice_absolute_id[i]||(choice_absolute_id[i]=0),n){case"radio":choice_absolute_id[i]++;r=choice_absolute_id[i];t+='<div class="question-title" type="6" name="radio-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N" choice-quote="0">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true" content-default="1">单选题<\/div><\/div><\/div><ul class="question-choice"><li class="choice" has_other="N" choice_absolute_id='+r+' ><input type="radio" name="radio"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项1 <\/div><\/div><div class="option-tips"><\/div><\/li>';choice_absolute_id[i]++;r=choice_absolute_id[i];t+='<li class="choice" has_other="N" choice_absolute_id='+r+'><input type="radio" name="radio"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项2 <\/div><\/div><div class="option-tips"><\/div><\/li><\/ul>';t+='<div class="add-area visible-hide"><ul><li class="add-choice" title="增加" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" title="批量增加" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';t+='<div class="operate visible-hide" ><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"checkbox":choice_absolute_id[i]++;r=choice_absolute_id[i];t+='<div class="question-title" type="8" name="checkbox-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N" choice-quote="0" min="" max="" exclusive-options="">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true" content-default="1">多选题<\/div><\/div><\/div><ul class="question-choice"><li class="choice" has_other="N" choice_absolute_id='+r+'><input type="checkbox" name="checkbox"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项1 <\/div><\/div><div class="option-tips"><\/div><\/li>';choice_absolute_id[i]++;r=choice_absolute_id[i];t+='<li class="choice" has_other="N" choice_absolute_id='+r+'><input type="checkbox" name="checkbox"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项2 <\/div><\/div><div class="option-tips"><\/div><\/li><\/ul>';t+='<div class="add-area visible-hide"><ul><li class="add-choice" title="增加" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" title="批量增加" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';t+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"input":t+='<div class="question-title" type="1" name="input-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true" content-default="1">单行填空题<\/div><\/div><\/div><ul class="question-choice"><li><input type="text" name="input" class="input-single"><\/li><\/ul>';t+='<div class="operate visible-hide" style="width: 240px;"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"multi-input":t+='<div class="question-title" type="2" name="multi-input-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true" content-default="1">多行填空题<\/div><\/div><\/div><ul class="question-choice"><li class="auto-height"><textarea name="multi-input" class="multi-input"><\/textarea><\/li><\/ul>';t+='<div class="operate visible-hide" style="width: 240px;"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"radio-matrix":t+='<div class="question-title" type="9" name="radio-matrix-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true" content-default="1">矩阵单选题<\/div><\/div><\/div><ul class="question-choice" style="float:left;width: 700px;"><li class="auto-height"><table style="border-collapse: collapse;"><tbody><tr><td>&nbsp<\/td><td name=radio-matrix-choice><div class="position-relative" style="width:100%"><li class="choice edit-area matrix-choice" has_other="N" contenteditable="true" content-default="1">选项1<\/li><\/div><\/td><td name=radio-matrix-choice><div class="position-relative" style="width:100%"><li class="choice edit-area matrix-choice" has_other="N" contenteditable="true" content-default="1">选项2<\/li><\/div><\/td><\/tr><tr><td class="radio_array_title" name="radio-matrix" ><div class="position-relative" style="width:100%"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">矩阵行1<\/div><\/div><\/td><td><input type="radio"/><\/td><td><input type="radio"/><\/td><\/tr><tr><td class="radio_array_title" name="radio-matrix"><div class="position-relative" style="width:100%"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">矩阵行2<\/div><\/div><\/td><td><input type="radio"/><\/td><td><input type="radio"/><\/td><\/tr><\/tbody><\/table><\/li><\/ul>';t+='<div class="add-area visible-hide" style="width: 34px; margin: 0px 0 0 46px;" choice="Y"><ul><li class="add-choice" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" style="margin-top: 14px;" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';t+='<div class="add-area visible-hide" choice="N"><ul><li class="add-choice" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';t+='<div class="operate visible-hide" style="width: 240px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"checkbox-matrix":t+='<div class="question-title" type="13" name="checkbox-matrix-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true" content-default="1">矩阵多选题<\/div><\/div><\/div><ul class="question-choice" style="float:left;width: 700px;"><li class="auto-height"><table style="border-collapse: collapse;"><tbody><tr><td>&nbsp<\/td><td name=checkbox-matrix-choice><div class="position-relative" style="width:100%"><li class="choice edit-area matrix-choice" has_other="N" contenteditable="true" content-default="1">选项1<\/li><\/div><\/td><td name=checkbox-matrix-choice><div class="position-relative" style="width:100%"><li class="choice edit-area matrix-choice" has_other="N" contenteditable="true" content-default="1">选项2<\/li><\/div><\/td><\/tr><tr><td class="checkbox_array_title" name="checkbox-matrix" ><div class="position-relative" style="width:100%"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">矩阵行1<\/div><\/div><\/td><td><input type="checkbox"/><\/td><td><input type="checkbox"/><\/td><\/tr><tr><td class="checkbox_array_title" name="checkbox-matrix"><div class="position-relative" style="width:100%"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">矩阵行2<\/div><\/div><\/td><td><input type="checkbox"/><\/td><td><input type="checkbox"/><\/td><\/tr><\/tbody><\/table><\/li><\/ul>';t+='<div class="add-area visible-hide" style="width: 34px; margin: 0px 0 0 46px;" choice="Y"><ul><li class="add-choice" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" style="margin-top: 14px;" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';t+='<div class="add-area visible-hide" choice="N"><ul><li class="add-choice" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';t+='<div class="operate visible-hide" style="width: 240px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"desc":t='<div class="topic-type-content topic-type-question after-clear"><div class="question-title" type="10" name="description"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="N" has_other="N"><\/span><div class="position-relative"><div class="qs-content qs-high-content edit-area edit-title" contenteditable="true" content-default="1">描述说明<\/div><\/div><\/div>';t+='<div class="operate visible-hide" style="width: 141px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"page":t='<div class="topic-type-content topic-page after-clear"> <div class="question-title" type="11" order="1" name="page" index="0" question-required="Y" has_other="N" title-quote="N" style="padding: 0px;height: 36px;"><span class="question-id" order="1" page="1" style="margin: 0px;"><\/span><div class="page-area">页码<\/div><\/div>';t+='<div class="operate visible-hide" style="width:94px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"select":for(t+='<div class="question-title" type="7" name="select-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N" choice-quote="0">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true">选择列表<\/div><\/div><\/div><select class="question-choice" style="  padding: 0;margin: 15px 0 20px 35px;">',u=1;4>u;u++)choice_absolute_id[i]++,r=choice_absolute_id[i],t+='<option class="choice" has_other="N" choice_absolute_id='+r+">选项"+u+"<\/option>";t+='<\/select><span class="edit-select" style="  width: 60%;display: inline-block;line-height: 30px;" onclick="edit.editSelect(this)">编辑选项<\/span>';t+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"upload":t+='<div class="question-title" type="12" name="upload-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true" content-default="1">上传图片<\/div><\/div><\/div><ul class="question-choice"><li>  <div class=survey-question-upload-btn> <div class=survey-question-upload-inner> <img src=/Content/Survey/images/upload-icon.png> <div class=survey-question-upload-inner-desc>选择图片20M以内 <\/div> <\/div> <input type=file class=survey-question-upload-file multiple> <\/div><\/li><\/ul>';t+='<div class="operate visible-hide" style="width: 190px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"radio-img":choice_absolute_id[i]++;r=choice_absolute_id[i];t+='<div class="question-title" type="14" name="radio-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N" choice-quote="0">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true" content-default="1">图片单选题<\/div><\/div><\/div>';t+='<ul class="question-choice"><\/ul>';t+='<div class="add-area survey-question-upload-img-wrap"><div class=survey-question-upload-img-btn> <div class=survey-question-upload-img-inner> <img src=/Content/Survey/images/upload-img-icon.png> <div class=survey-question-upload-img-inner-title>点击上传图片<\/div> <div class=survey-question-upload-img-inner-desc>最多可上传50张图片<\/div> <\/div> <input type=file class=survey-question-upload-img-file name=upload_img multiple> <\/div><\/div>';t+='<div class="operate visible-hide" ><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"checkbox-img":choice_absolute_id[i]++;r=choice_absolute_id[i];t+='<div class="question-title" type="15" name="checkbox-question"><span class="question-id" order="1" page="1" index="1" absolute_id='+i+' question-required="Y" has_other="N" title-quote="N" choice-quote="0" min="" max="">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true" content-default="1">图片多选题<\/div><\/div><\/div>';t+='<ul class="question-choice"><\/ul>';t+='<div class="add-area survey-question-upload-img-wrap"><div class=survey-question-upload-img-btn> <div class=survey-question-upload-img-inner> <img src=/Content/Survey/images/upload-img-icon.png> <div class=survey-question-upload-img-inner-title>点击上传图片<\/div> <div class=survey-question-upload-img-inner-desc>最多可上传50张图片<\/div> <\/div> <input type=file class=survey-question-upload-img-file name=upload_img multiple> <\/div><\/div>';t+='<div class="operate visible-hide" ><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>'}t+="<\/div>";$("#question-box").append(t);edit.sortQuestions();edit.attachLayer();edit.updateChoiceShowLogic();edit.scrollBox();edit.visibleHandle();elementInit()}function selectEditedQuestion(n){var r=n.question_content,t=r.choice,i="",f,c,o,l,h,s,e,u;i+='<div class="topic-type-content topic-type-question after-clear">';switch(r.absolute_id?f=r.absolute_id:(f=parseInt(absolute_id)+1,absolute_id++),r.type_id){case"6":choice_absolute_id[f]=0;i+='<div class="question-title" type="6" name="radio-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" choice-quote="'+r.choice_quote+'" absolute_id='+f+'  question-required="'+r.required+'" has_other="'+r.has_other+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true">'+r.content+'<\/div><\/div><\/div><ul class="question-choice">';for(u in t)t[u].required="undefined"==typeof t[u].required?0:parseInt(t[u].required,10),t[u].choice_absolute_id?(e=parseInt(t[u].choice_absolute_id,10),e>parseInt(choice_absolute_id[f],10)&&(choice_absolute_id[f]=e)):(e=parseInt(choice_absolute_id[f],10)+1,choice_absolute_id[f]++),i+='<li class="choice" has_other="'+t[u].is_other+'" choice_required="'+t[u].required+'" choice_absolute_id='+e+' ><input type="radio" name="radio"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true">'+t[u].content+"<\/div><\/div>","Y"===t[u].is_other&&(i+='<input type="text" class="other-content"  style="width: 120px;height: 30px;vertical-align: middle;" >',1===parseInt(t[u].required,10)&&(i+='<span class="required-content">(必填)<\/span>')),i+='<div class="option-tips"><\/div><\/li>';i+='<\/ul><div class="add-area visible-hide"><ul><li class="add-choice" title="增加" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" title="批量增加" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';i+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"14":choice_absolute_id[f]=0;i+='<div class="question-title" type="14" name="radio-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" choice-quote="'+r.choice_quote+'" absolute_id='+f+'  question-required="'+r.required+'" has_other="'+r.has_other+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true">'+r.content+'<\/div><\/div><\/div><ul class="question-choice">';for(u in t)t[u].required="undefined"==typeof t[u].required?0:parseInt(t[u].required,10),t[u].contentArr=t[u].content.split("#**#"),t[u].choice_absolute_id?(e=parseInt(t[u].choice_absolute_id,10),e>parseInt(choice_absolute_id[f],10)&&(choice_absolute_id[f]=e)):(e=parseInt(choice_absolute_id[f],10)+1,choice_absolute_id[f]++),i+='<li class="choice survey-question-radio-img" has_other="'+t[u].is_other+'" choice_required="'+t[u].required+'" choice_absolute_id='+e+' > <div class=survey-question-radio-choice> <a class="remove-child-element survey-question-radio-img-remove" onclick="edit.removeChildElement()"><\/a><div class=survey-question-radio-choice-img> <img src="'+t[u].contentArr[1]+'"> <\/div> <div class=survey-question-radio-choice-text> <input type=radio name=radio> <label class="edit-area edit-child-element" contenteditable=true>'+t[u].contentArr[0]+'<\/label> <div class="option-tips"><\/div><\/div> <\/div>',i+="<\/li>";i+="<\/ul>";i+='<div class="add-area survey-question-upload-img-wrap"><div class=survey-question-upload-img-btn> <div class=survey-question-upload-img-inner> <img src=/Content/Survey/images/upload-img-icon.png> <div class=survey-question-upload-img-inner-title>点击上传图片<\/div> <div class=survey-question-upload-img-inner-desc>最多可上传50张图片<\/div> <\/div> <input type=file class=survey-question-upload-img-file name=upload_img multiple> <\/div><\/div>';i+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"15":choice_absolute_id[f]=0;i+='<div class="question-title" type="15" name="checkbox-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" choice-quote="'+r.choice_quote+'" absolute_id='+f+'  question-required="'+r.required+'" has_other="'+r.has_other+'" min="'+r.min+'" max="'+r.max+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true">'+r.content+'<\/div><\/div><\/div><ul class="question-choice">';for(u in t)t[u].required="undefined"==typeof t[u].required?0:parseInt(t[u].required,10),t[u].contentArr=t[u].content.split("#**#"),t[u].choice_absolute_id?(e=parseInt(t[u].choice_absolute_id,10),e>parseInt(choice_absolute_id[f],10)&&(choice_absolute_id[f]=e)):(e=parseInt(choice_absolute_id[f],10)+1,choice_absolute_id[f]++),i+='<li class="choice survey-question-checkbox-img" has_other="'+t[u].is_other+'" choice_required="'+t[u].required+'" choice_absolute_id='+e+' > <div class=survey-question-checkbox-choice> <a class="remove-child-element survey-question-checkbox-img-remove" onclick="edit.removeChildElement()"><\/a><div class=survey-question-checkbox-choice-img> <img src="'+t[u].contentArr[1]+'"> <\/div> <div class=survey-question-checkbox-choice-text> <input type=checkbox name=checkbox> <label class="edit-area edit-child-element" contenteditable=true>'+t[u].contentArr[0]+'<\/label> <div class="option-tips"><\/div><\/div> <\/div>',i+="<\/li>";i+="<\/ul>";i+='<div class="add-area survey-question-upload-img-wrap"><div class=survey-question-upload-img-btn> <div class=survey-question-upload-img-inner> <img src=/Content/Survey/images/upload-img-icon.png> <div class=survey-question-upload-img-inner-title>点击上传图片<\/div> <div class=survey-question-upload-img-inner-desc>最多可上传50张图片<\/div> <\/div> <input type=file class=survey-question-upload-img-file name=upload_img multiple> <\/div><\/div>';i+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"8":choice_absolute_id[f]=0;i+='<div class="question-title" type="8" name="checkbox-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" choice-quote="'+r.choice_quote+'" absolute_id='+f+' question-required="'+r.required+'" has_other="'+r.has_other+'" min="'+r.min+'" max="'+r.max+'" exclusive-options="'+(r.exclusive_options?r.exclusive_options:"")+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true">'+r.content+' <\/div><\/div><\/div><ul class="question-choice">';for(u in t)t[u].required="undefined"==typeof t[u].required?0:parseInt(t[u].required,10),t[u].choice_absolute_id?(e=parseInt(t[u].choice_absolute_id,10),e>parseInt(choice_absolute_id[f],10)&&(choice_absolute_id[f]=e)):(e=parseInt(choice_absolute_id[f],10)+1,choice_absolute_id[f]++),i+='<li class="choice" has_other="'+t[u].is_other+'" choice_required="'+t[u].required+'" choice_absolute_id='+e+'><input type="checkbox" name="checkbox"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true">'+t[u].content+"<\/div><\/div>","Y"===t[u].is_other&&(i+='<input type="text" class="other-content"  style="width: 120px;height: 30px;vertical-align: middle;" >',1===parseInt(t[u].required,10)&&(i+='<span class="required-content">(必填)<\/span>')),i+='<div class="option-tips"><\/div><\/li>';i+='<\/ul><div class="add-area visible-hide"><ul><li class="add-choice" title="增加" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" title="批量增加" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';i+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"1":i+='<div class="question-title" type="1" name="input-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" absolute_id='+f+' question-required="'+r.required+'" has_other="'+r.has_other+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true">'+r.content+' <\/div><\/div><\/div><ul class="question-choice"><li><input type="text" name="input" class="input-single"><\/li><\/ul>';i+='<div class="operate visible-hide" style="width: 240px;"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"2":i+='<div class="question-title" type="2" name="multi-input-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" absolute_id='+f+' question-required="'+r.required+'" has_other="'+r.has_other+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true">'+r.content+'<\/div><\/div><\/div><ul class="question-choice"><li class="auto-height"><textarea name="multi-input" class="multi-input"><\/textarea><\/li><\/ul>';i+='<div class="operate visible-hide" style="width: 240px;" ><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"9":i+='<div class="question-title" type="9" name="radio-matrix-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" absolute_id='+f+' question-required="'+r.required+'" has_other="'+r.has_other+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true">'+r.content+'<\/div><\/div><\/div><ul class="question-choice" style="float:left;width: 700px;"><li class="auto-height"><table style="border-collapse: collapse;"><tbody><tr><td>&nbsp<\/td>';for(o in t)t[o].required="undefined"==typeof t[o].required?0:parseInt(t[o].required,10),i+='<td name=radio-matrix-choice><div class="position-relative" style="width:100%"><li class="choice edit-area matrix-choice" contenteditable="true" has_other="'+t[o].is_other+'" choice_required="'+t[o].required+'">'+t[o].content+"<\/li><\/div><\/td>";i+="<\/tr>";c=r.radio_array_title;for(h in c){for(i+='<tr><td class="radio_array_title" name="radio-matrix"><div class="position-relative" style="width:100%"><div class="edit-area edit-child-element" contenteditable="true">'+c[h].content+"<\/div><\/div><\/td>",s=0;s<t.length;s++)i+='<td><input type="radio"/>',"Y"==t[s].is_other&&(i+='<input type="text" class="other-content" style="width: 120px;height: 30px;vertical-align: middle;" >',1===parseInt(t[s].required,10)&&(i+='<span class="required-content">(必填)<\/span>')),i+="<\/td>";i+="<\/tr>"}i+='<\/tbody><\/table><\/li><\/ul><div class="add-area visible-hide" style="width: 34px; margin: 0px 0 0 46px;" choice="Y"><ul><li class="add-choice" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" style="margin-top: 14px;" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';i+='<div class="add-area visible-hide" choice="N"><ul><li class="add-choice" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';i+='<div class="operate visible-hide" style="width: 240px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"13":i+='<div class="question-title" type="13" name="checkbox-matrix-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" absolute_id='+f+' question-required="'+r.required+'" has_other="'+r.has_other+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true">'+r.content+'<\/div><\/div><\/div><ul class="question-choice" style="float:left;width: 700px;"><li class="auto-height"><table style="border-collapse: collapse;"><tbody><tr><td>&nbsp<\/td>';for(o in t)t[o].required="undefined"==typeof t[o].required?0:parseInt(t[o].required,10),i+='<td name=checkbox-matrix-choice><div class="position-relative" style="width:100%"><li class="choice edit-area matrix-choice" contenteditable="true" has_other="'+t[o].is_other+'" choice_required="'+t[o].required+'">'+t[o].content+"<\/li><\/div><\/td>";i+="<\/tr>";l=r.checkbox_array_title;for(h in l){for(i+='<tr><td class="checkbox_array_title" name="checkbox-matrix"><div class="position-relative" style="width:100%"><div class="edit-area edit-child-element" contenteditable="true">'+l[h].content+"<\/div><\/div><\/td>",s=0;s<t.length;s++)i+='<td><input type="checkbox"/>',"Y"==t[s].is_other&&(i+='<input type="text" class="other-content" style="width: 120px;height: 30px;vertical-align: middle;" >',1===parseInt(t[s].required,10)&&(i+='<span class="required-content">(必填)<\/span>')),i+="<\/td>";i+="<\/tr>"}i+='<\/tbody><\/table><\/li><\/ul><div class="add-area visible-hide" style="width: 34px; margin: 0px 0 0 46px;" choice="Y"><ul><li class="add-choice" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" style="margin-top: 14px;" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';i+='<div class="add-area visible-hide" choice="N"><ul><li class="add-choice" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';i+='<div class="operate visible-hide" style="width: 240px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"10":i='<div class="topic-type-content topic-type-question after-clear"> <div class="question-title" type="10" name="description"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" absolute_id='+f+' question-required="'+r.required+'" has_other="'+r.has_other+'"><\/span><div class="position-relative"><div class="qs-content qs-high-content edit-area edit-title" contenteditable="true">'+r.content+"<\/div><\/div><\/div>";i+='<div class="operate visible-hide" style="width: 141px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"11":i='<div class="topic-type-content topic-page after-clear"> <div class="question-title" type="11" order="1" name="page" index="0" title-quote="'+r.title_quote+'" question-required="'+r.required+'" has_other="'+r.has_other+'" style="padding: 0px;height: 36px;"><span class="question-id" order="1" page="1" style="margin: 0px;"><\/span><div class="page-area">页码<\/div><\/div>';i+='<div class="operate visible-hide" style="width:94px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"7":choice_absolute_id[f]=0;i+='<div class="question-title" type="7" name="radio-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" choice-quote="'+r.choice_quote+'" absolute_id='+f+' question-required="'+r.required+'" has_other="'+r.has_other+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" tabindex="0" contenteditable="true">'+r.content+'<\/div><\/div><\/div><select class="question-choice" style="  padding: 0;margin: 15px 0 20px 35px;">';for(u in t)t[u].choice_absolute_id?(e=parseInt(t[u].choice_absolute_id,10),e>parseInt(choice_absolute_id[f],10)&&(choice_absolute_id[f]=e)):(e=parseInt(choice_absolute_id[f],10)+1,choice_absolute_id[f]++),i+='<option class="choice" has_other="'+t[u].is_other+'" choice_absolute_id='+e+">"+t[u].content+"<\/option>";i+='<\/select><span class="edit-select" style="  width: 60%;display: inline-block;line-height: 30px;" onclick="edit.editSelect(this)">编辑选项<\/span>';i+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case"12":i+='<div class="question-title" type="12" name="upload-question"><span class="question-id" order="1" page="1" index="1" title-quote="'+r.title_quote+'" absolute_id='+f+' question-required="'+r.required+'" has_other="'+r.has_other+'">1<\/span><div class="position-relative"><div class="qs-content edit-area edit-title" contenteditable="true">'+r.content+' <\/div><\/div><\/div><ul class="question-choice"><li>  <div class=survey-question-upload-btn> <div class=survey-question-upload-inner> <img src=/Content/Survey/images/upload-icon.png> <div class=survey-question-upload-inner-desc>选择图片20M以内 <\/div> <\/div> <input type=file class=survey-question-upload-file multiple> <\/div><\/li><\/ul>';i+='<div class="operate visible-hide" style="width: 190px;"><ul><li class="drag-area" title="移动"><\/li><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>'}i+="<\/div>";$("#question-box").append(i);edit.sortQuestions();edit.attachLayer();edit.updateChoiceShowLogic();edit.updateByChoiceQuote();edit.showExclusiveOptions();edit.visibleHandle()}function selectQuestionGroup(n){n.siblings("ul").is(":visible")?(n.css({background:"url(/Content/Survey/images/side_bar_hide.png) no-repeat","border-bottom":"none"}),n.siblings("ul").hide()):(n.css({background:"url(/Content/Survey/images/side_bar_show.png) no-repeat","border-bottom":"1px solid #dbdbdb"}),n.parent().siblings("div").find(".classify-title").css({background:"url(/Content/Survey/images/side_bar_hide.png) no-repeat","border-bottom":"none"}),n.siblings("ul").show(),n.parent().siblings("div").find("ul").hide())}function getRelation(){var n={};return angular.forEach(redirect_relation,function(t,i){var r=!1;t&&angular.forEach(t,function(n){n&&(r=!0)});r&&(n[i]=t)}),n}function ImgEditSize(n){return this.main=function(n){this.obj=$(n);this.event()},this.status=!0,this.status_menu=!0,this.event=function(){var n=this;this.obj.mouseover(function(){n.status_menu=!1;n.Menu&&n.DelMenu();n.addMenu()});this.obj.mouseout(function(){setTimeout(function(){n.DelMenu()},50)})},this.addMenu=function(){var n=this;this.Menu=$('<div class="img-edit-size"><ul><li class="enl" title="放大"><\/li><li class="ori" title="原图"><\/li><li class="nar" title="缩小"><\/li><li class="del" title="删除"><\/li><\/ul><\/div>');$("body").append(n.Menu);this.Menu.css({position:"absolute",top:n.obj.offset().top+5+"px",left:n.obj.offset().left+5+"px"});this.Menu.hover(function(){n.status=!1},function(){n.status=!0;n.status_menu=!0;setTimeout(function(){n.status_menu&&n.DelMenu()},200)});this.Menu.find(".enl").click(function(){var t=n.obj.width(),i=n.obj.height(),r=t/i;return t>=580?!1:(n.getImgWH(t+20*r,i+20),!1)});this.Menu.find(".ori").click(function(){return n.imgSize(n.obj.attr("src")),!1});this.Menu.find(".nar").click(function(){var t=n.obj.width(),i=n.obj.height(),r=t/i;return 100>=t?!1:(n.getImgWH(t-20*r,i-20),!1)});this.Menu.find(".del").click(function(){return n.obj.remove(),n.status=!0,n.DelMenu(),!1})},this.getImgWH=function(n,t){this.obj.width(n);this.obj.height(t)},this.DelMenu=function(){this.status&&this.Menu.remove()},this.imgSize=function(n){var i=this,t=new Image;t.onload=function(){t.width>620&&(t.width=i.obj.attr("width"),t.height=i.obj.attr("height"));i.getImgWH(t.width,t.height)};t.src=n},this.main(n)}function selectFinish(){$(".select-ul").each(function(){if($(this).siblings(".add-area").length>0){var n='<select class="question-choice" style="  padding: 0;margin: 15px 0 20px 35px;">';$(this).find(".choice").each(function(){n+='<option class="choice" has_other="N" choice_absolute_id='+$(this).attr("choice_absolute_id")+">"+$(this).find(".edit-area").html()+"<\/option>"});n+='<\/select><span class="edit-select" onclick="edit.editSelect(this)" style="  width: 60%;display: inline-block;line-height: 30px;">编辑选项<\/span>';$(this).siblings(".question-title").after(n);$(this).siblings(".question-title").attr("type","7");$(this).siblings(".add-area").remove();$(this).remove()}})}function fontStyle(){if($(".edit-area-active").length){var n=$(".edit-area-active").html();n=n.replace(/<\/?[^>(IMG)(img)][^>]*>/g,"");$(".edit-area-active").html(n)}}function setLogic(n){require.async(["home:static/js/survey/widget/edit_logic_pop.js"],function(t){t.show(n,null,null)})}function elementInit(){$(".edit-area").focus(function(){var t,n;$("div, td, li, label").removeClass("edit-area-active");$(this).hasClass("edit-area-active")||$(this).addClass("edit-area-active");activeFocus();t=parseInt($(this).parents(".question-choice").siblings(".question-title").attr("type"),10);14!=t&&15!=t&&($(this).after($(".edit-img")),$(".edit-img").css($(this).hasClass("qs-content")||$(this).hasClass("title-content")?{width:"30px"}:$(this).hasClass("matrix-choice")?{width:"65px"}:$(this).parents("td").hasClass("radio_array_title")||$(this).parents("td").hasClass("checkbox_array_title")||$(this).parents("li").hasClass("select_choice")?{width:"95px"}:{width:"155px"}),$(".edit-img").show());$(".edit-area").css({background:"#fff",border:"none"});$(".title-content").css({border:"1px solid #dbdbdb"});$(this).css({background:"#fdf9cd",border:"1px solid #333"});14!=t&&15!=t&&($(this).hasClass("edit-title")?($(".upload-element-img").show(),$(".handle-element").hide()):$(this).parents("td").hasClass("radio_array_title")||$(this).parents("td").hasClass("checkbox_array_title")||$(this).parents("li").hasClass("select_choice")?($(".handle-element").show(),$(".handle-child-element").hide(),$(".upload-element-img").hide()):$(this).hasClass("matrix-choice")?($(".handle-element").show(),$(".up-child-element").hide(),$(".down-child-element").hide(),$(".upload-element-img").hide()):$(this).hasClass("title-content")?$(".edit-img").hide():$(this).hasClass("desc-content")?($(".edit-img").css({width:"30px"}),$(".handle-element").hide()):($(".upload-element-img").show(),$(".handle-element").show()));n=$(this).html().replace(/&nbsp;/gi," ");n=n.replace(/<br>/gi,"\n");n=$.trim(n);$(this).hasClass("edit-title")&&edit.isDefaultQuestion(n)&&($(this).attr("data-value",n),$(this).html(""));($(this).hasClass("edit-child-element")||$(this).hasClass("choice"))&&edit.isDefaultChoice(n)&&($(this).attr("data-value",n),$(this).html(""))});$(".title-content").on("keydown",function(n){if($(this).text().length>=17){var t=($(this).text(),n.keyCode||n.which);if(8!=t&&46!=t)return!1}});$(".edit-area").blur(function(){var n=$(this).html().replace(/&nbsp;/gi," "),t,i;if(n=n.replace(/<br>/gi,"\n"),n=$.trim(n),$(this).hasClass("title-content"))return void(n.length>17?($(".survey-title .error-tips").addClass("error"),$(".survey-title .error-tips").text("问卷名称不能超过17字"),surveyTitle=""):0==n.length?($(".survey-title .error-tips").addClass("error"),$(".survey-title .error-tips").text("问卷名称不能为空"),surveyTitle=""):($(".survey-title .error-tips").removeClass("error"),surveyTitle=n));""==n?(t=$(this).attr("data-value"),void 0!==t?$(this).html(t):$(this).hasClass("edit-title")?($(this).nextAll(".error").remove(),$(this).after('<span class="error-tips error">题干为空<\/span>'),$(this).trigger("focus")):$(this).hasClass("edit-child-element")&&(i=$(this).parents(".question-choice").children().length,i>1&&$(this).parents(".choice").find(".remove-child-element").click())):($(this).nextAll(".error").remove(),0==edit.isDefaultQuestion(n)&&$(this).removeAttr("data-value"));setUpdateStatus()});$(".edit-area").hover(function(){$(this).hasClass("edit-area-active")||$(this).css({background:"#fdf9cd"})},function(){$(this).hasClass("edit-area-active")||$(this).css({background:"#fff"})});$(".edit-area").on("paste",function(){var n=$(this),t=parseInt($(this).parents(".question-choice").siblings(".question-title").attr("type"),10);setTimeout(function(){var i=n.text();i=i.replace(/<[^<]*>/g,"");(14==t||15==t)&&(i=i.substring(0,50));n.text(i)},0)});$(".edit-area").keypress(function(){var n=parseInt($(this).parents(".question-choice").siblings(".question-title").attr("type"),10);if((14==n||15==n)&&$(this).text().length>=50)return!1});$("body").on("focus",".edit-area",function(){var n=$(this);return n.data("before",n.html()),n}).on("blur keyup paste input",".edit-area",function(){var n=$(this);return n.data("before")!==n.html()&&(n.data("before",n.html()),n.trigger("change")),n});$(".edit-area").change(function(){edit.updateUploadAll()});edit.updateQuestionType()}function getQuoteIndex(n){var i=n.match(/\[Q[0-9]*[1-9][0-9]*\]/g),t;return null===i?!1:(t=[],$.each(i,function(n,i){var r=i.substring(2,i.length-1);inArray(r,t)||t.push(r)}),t)}function checkIndexes(n){if(n){var t=!0;return $.each(n,function(n,i){"9"==$(".question-id[index="+i+"]").parent().attr("type")&&(t=!1)}),t}return!1}function activeFocus(){$(".choice .edit-area").css({display:"inline-block"});$(".choice .edit-area-active").css({display:"inline-block"})}function setUpdateStatus(){updateStatus=1}function clearUpdateStatus(){updateStatus=1}var edit,showAlert,surveyTool;require("common:widget/sidebar/sidebar.js");jQuery.browser={},function(){jQuery.browser.msie=!1;jQuery.browser.version=0;navigator.userAgent.match(/MSIE ([0-9]+)./)&&(jQuery.browser.msie=!0,jQuery.browser.version=RegExp.$1)}();$(function(){$("body").on("click",".cb",function(n){n.preventDefault();$(this).hasClass("checked")?$(this).removeClass("checked"):$(this).addClass("checked")});$("body").on("click",".cb-radio",function(n){return n.preventDefault(),$(this).hasClass("checked")?!1:($(this).addClass("checked"),$(this).find("input").attr("checked","true"),$(this).siblings(".cb-radio").removeClass("checked").find("input").removeAttr("checked"),void 0)});$(".bce-menu-list-item").on("click",function(){var n=$(this).parent(".bce-menu-list");null!==n&&void 0!==n&&(n.hasClass("bce-menu-list-open")?n.removeClass("bce-menu-list-open"):($(".bce-menu-list").removeClass("bce-menu-list-open"),n.addClass("bce-menu-list-open")))})});var alert=function(n,t,i){var b=addShade(),f=document.body,r=newElem("div","dialog-body","bce-dialog"),c=newElem("div",null,"bce-dialog-head"),e=newElem("div",null,"bce-dialog-title"),o,l,u,a,h;c.appendChild(e);o=newElem("span");l=document.createTextNode(t||"信息提示");o.appendChild(l);e.appendChild(o);u=newElem("span",null,"close");a=document.createTextNode("×");u.appendChild(a);e.appendChild(u);r.appendChild(c);var v=newElem("div",null,"bce-dialog-body-panel"),y=newElem("div","dialog-msg"),k=document.createTextNode(n);y.appendChild(k);v.appendChild(y);r.appendChild(v);var p=newElem("div",null,"bce-dialog-foot-panel"),w=newElem("div",null,"bce-dialog-foot"),s=newElem("div",null,"bce-dialog-ok-btn bce-ui-button"),d=document.createTextNode("确定");s.appendChild(d);w.appendChild(s);p.appendChild(w);r.appendChild(p);f.appendChild(r);h=function(){f.removeChild(b);f.removeChild(r)};s.onclick=function(){h();i&&i()};u.onclick=function(){h()}},alertTip=function(n,t,i){var v=(addShade(),document.body),r=newElem("div","dialog-body","bce-dialog"),e=newElem("div",null,"bce-dialog-head"),o=newElem("div",null,"bce-dialog-title"),u,s;e.appendChild(o);u=newElem("span");s=document.createTextNode(t||"信息提示");u.appendChild(s);o.appendChild(u);r.appendChild(e);var h=newElem("div",null,"bce-dialog-body-panel"),c=newElem("div","dialog-msg"),y=document.createTextNode(n);c.appendChild(y);h.appendChild(c);r.appendChild(h);var l=newElem("div",null,"bce-dialog-foot-panel"),a=newElem("div",null,"bce-dialog-foot"),f=newElem("div",null,"bce-dialog-ok-btn bce-ui-button"),p=document.createTextNode("确定");f.appendChild(p);a.appendChild(f);l.appendChild(a);r.appendChild(l);v.appendChild(r);f.onclick=function(){i&&i()}},alertRich=function(n,t,i,r,u){var p=addShade(),s=document.body,e=newElem("div","dialog-body-rich"),c=newElem("div","dialog-title"),l=newElem("span"),w=document.createTextNode(t||"信息提示"),h,o,v,y;l.appendChild(w);c.appendChild(l);e.appendChild(c);var f=newElem("div","dialog-content-holder"),b=newElem("div","dialog-alert-icon"),a=newElem("div","dialog-sub-title");a.innerHTML=i;h=newElem("div","dialog-msg");h.innerHTML=n;o=newElem("div","dialog-ok-btn","dialog-btn");v=document.createTextNode(r||"确定");o.appendChild(v);f.appendChild(b);f.appendChild(a);f.appendChild(h);f.appendChild(o);e.appendChild(f);s.appendChild(e);y=function(){s.removeChild(p);s.removeChild(e)};o.onclick=function(){y();u&&u()}},confirm=function(n,t,i,r){var g=addShade(),s=document.body,u=newElem("div","dialog-body","bce-dialog"),v=newElem("div",null,"bce-dialog-head"),h=newElem("div",null,"bce-dialog-title"),c,y,f,p,e,d,o;v.appendChild(h);c=newElem("span");y=document.createTextNode(t||"信息提示");c.appendChild(y);h.appendChild(c);f=newElem("span",null,"close");p=document.createTextNode("×");f.appendChild(p);h.appendChild(f);u.appendChild(v);var w=newElem("div",null,"bce-dialog-body-panel"),b=newElem("div","dialog-msg"),nt=document.createTextNode(n);b.appendChild(nt);w.appendChild(b);u.appendChild(w);var k=newElem("div",null,"bce-dialog-foot-panel"),l=newElem("div",null,"bce-dialog-foot"),a=newElem("div",null,"bce-dialog-ok-btn bce-ui-button"),tt=document.createTextNode("确定");a.appendChild(tt);e=newElem("div",null,"bce-dialog-cancel-btn bce-ui-button");d=document.createTextNode("取消");e.appendChild(d);l.appendChild(a);l.appendChild(e);k.appendChild(l);u.appendChild(k);s.appendChild(u);o=function(){s.removeChild(g);s.removeChild(u)};a.onclick=function(){o();i&&i()};e.onclick=function(){o();r&&r()};f.onclick=function(){o()}},prompt=function(n,t,i,r){var p=addShade(),h=document.body,u=newElem("div","dialog-body","vip"),c=newElem("div","dialog-title"),l=newElem("span"),w=document.createTextNode(t||"信息提示"),e,v,o,y,s;l.appendChild(w);c.appendChild(l);u.appendChild(c);var f=newElem("div","dialog-content-holder","vip"),a=newElem("div","dialog-msg"),n=n;n+='<p><input type="text" id="prompt-value" style="width:280px;"><\/p>';n+='<p style="position:absolute;"><span id="prompt-msg" class="text-danger"><\/span><\/p>';n+='<div style="height:10px;">&nbsp;<\/div>';n+='<img src="/static/common/widget/footer/weixin.jpg" style="width:140px;position:absolute;top:60px;right:20px;border-left:solid 1px #ddd;padding-left:10px;">';a.innerHTML=n;e=newElem("div","dialog-ok-btn","dialog-btn vip");v=document.createTextNode("确认");e.appendChild(v);f.appendChild(a);f.appendChild(e);o=newElem("div","dialog-cancel-btn","dialog-btn");y=document.createTextNode("取消");o.appendChild(y);f.appendChild(o);u.appendChild(f);h.appendChild(u);s=function(){h.removeChild(p);h.removeChild(u)};e.onclick=function(){i(s)};o.onclick=function(){s();r&&r()};$("body").on("keydown","#prompt-value",function(n){13==n.keyCode&&i(s)});$("#prompt-value")[0].focus()},payAlert=function(n,t){var v=addShade(),e=document.body,i=newElem("div","dialog-body"),s=newElem("div","dialog-title"),h=newElem("span"),y=document.createTextNode("支付完成前不要关闭页面"),u,l,f,a,o;h.appendChild(y);s.appendChild(h);i.appendChild(s);var r=newElem("div","dialog-content-holder"),c=newElem("div","dialog-msg"),p=document.createTextNode("请在新打开的页面完成支付后选择");c.appendChild(p);r.appendChild(c);u=newElem("div","dialog-ok-btn","dialog-btn vip");l=document.createTextNode("完成支付");u.appendChild(l);r.appendChild(u);f=newElem("div","dialog-cancel-btn","dialog-btn");a=document.createTextNode("遇到问题");f.appendChild(a);r.appendChild(f);i.appendChild(r);e.appendChild(i);o=function(){e.removeChild(v);e.removeChild(i)};u.onclick=function(){o();n&&n()};f.onclick=function(){o();t&&t()}},vip=function(n,t,i){var p=addShade(),s=document.body,u=newElem("div","dialog-body","vip"),c=newElem("div","dialog-title"),l=newElem("span"),w=document.createTextNode("开通VIP提示"),e,v,o,y,h;l.appendChild(w);c.appendChild(l);u.appendChild(c);var f=newElem("div","dialog-content-holder","vip"),a=newElem("div","dialog-msg"),r="<h4>尊敬的用户，您好：<\/h4>";r+='<p class="text-sub">'+n+"<\/p>";r+="<hr>";r+='<h4 class="vip-title text-center"><img src="/static/common/img/king.png"/>&nbsp;<span>VIP会员特权<span><\/h4>';r+='<ul class="text-sub vip-desc clearfix">';r+="<li>兼容测试支持TOP300以上<\/li>";r+="<li>支持所有机型自定义单选<\/li>";r+="<li>性能测试支持添加多个竞品<\/li>";r+="<li>遍历测试延长时间至15分钟<\/li>";r+="<\/ul>";a.innerHTML=r;e=newElem("div","dialog-ok-btn","dialog-btn vip");v=document.createTextNode("是的，我要开通");e.appendChild(v);o=newElem("div","dialog-cancel-btn","dialog-btn");y=document.createTextNode("不用，重新选择");o.appendChild(y);f.appendChild(a);f.appendChild(e);f.appendChild(o);u.appendChild(f);s.appendChild(u);h=function(){s.removeChild(p);s.removeChild(u)};e.onclick=function(){h();t&&t()};o.onclick=function(){h();i&&i()}},newAlertRich=function(n,t,i,r,u){var p=addShade(),s=document.body,e=newElem("div","new-dialog-body-rich"),c=newElem("div","new-dialog-title"),l=newElem("span"),w=document.createTextNode(t||"信息提示"),h,o,v,y;l.appendChild(w);c.appendChild(l);e.appendChild(c);var f=newElem("div","new-dialog-content-holder"),b=newElem("div","new-dialog-success-icon"),a=newElem("div","new-dialog-sub-title");a.innerHTML=i;h=newElem("div","new-dialog-msg");h.innerHTML=n;o=newElem("div","new-dialog-single-btn","new-dialog-btn");v=document.createTextNode(r||"确定");o.appendChild(v);f.appendChild(b);f.appendChild(a);f.appendChild(h);f.appendChild(o);e.appendChild(f);s.appendChild(e);y=function(){s.removeChild(p);s.removeChild(e)};o.onclick=function(){y();u&&u()}},newElem=function(n,t,i){var r=document.createElement(n);return t&&(r.id=t),i&&(r.className=i),r},addShade=function(){var t=document.body,n=newElem("div","shade");return n.style.height=t.outerHeight+"px",t.appendChild(n),n},showImage=function(n){var i=document.body,u=addShade(),t=newElem("div","img-body"),f=newElem("a","img-close"),o=newElem("div","img-border"),e=newElem("img","img-img"),r;e.src=n;t.appendChild(o);t.appendChild(f);t.appendChild(e);i.appendChild(t);r=function(){i.removeChild(u);i.removeChild(t)};f.onclick=function(){r()};u.onclick=function(){r()}};define("home:static/js/survey/widget/batchAddChoice.js",function(n,t){"use strict";var i='<div class=question-handle-dialog> <div class=handle-dialog> <div class=handle-dialog-title>批量添加选项<span class=close>&times;<\/span><\/div> <div class=handle-dialog-content> <div class=add-content> <div class=add-content-tip>每行代表一个选项，可以添加多个选项<\/div> <div class=choice-area> <textarea class="batch-choices"><\/textarea> <\/div> <\/div> <\/div> <div class=handle-dialog-button> <span class=batch-add-error><\/span> <input type=button class="dialog-button-survey button-confirm" id=survey-confirm-y value="确定">&nbsp; <input type=button class="dialog-button-survey button-cancel" id=survey-confirm-n value="取消"> <\/div> <\/div> <div class=survey-mask><\/div><\/div>';$("body").append("<style>.handle-dialog{font-size:14px;font-family:微软雅黑;position:fixed;left:50%;top:40%;width:500px;min-height:220px;margin-left:-250px;background:#fff;border-radius:4px;border:1px solid #f6f9fe;z-index:1003;padding-bottom:30px}.handle-dialog-title{height:40px;line-height:40px;padding-left:16px;color:#2c4a93;background:#f1f5fd;border-bottom:1px solid #b0c0e7}.handle-dialog-content{margin:15px;color:#666}.handle-dialog-button{text-align:center;height:20px;line-height:20px;padding-top:0px}.survey-mask{position:fixed;height:100%;width:100%;background:#aaa;z-index:1002;top:0;left:0;opacity:.5;filter:alpha(opacity:50)}.button{width:64px;height:30px;line-height:20px;border-radius:3px;background:#f1f5fd;border:1px solid #b0c0e7;color:#2c4a93;cursor:pointer}.button:hover{background:#f1f5fd;border:1px solid #6583cc;color:#2c4a93}.button-confirm{background:#249cfa;border:1px solid #249cfa;color:#fff}.button-confirm:hover{background:#48aefe;border:1px solid #48aefe;color:#fff}.close{font-size:18px;line-height:40px!important;font-weight:700;color:#666;float:right;padding-right:16px;cursor:pointer}.add-content-tip{line-height:24px;margin:10px 0 4px 0}.choice-area{margin:0 16px 12px 0}.batch-choices{height:100px;width:470px;overflow:auto;resize:none;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;background-color:#fff;border:1px solid #ccc;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);-moz-box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);-webkit-transition:border linear .2s,box-shadow linear .2s;-moz-transition:border linear .2s,box-shadow linear .2s;-o-transition:border linear .2s,box-shadow linear .2s;transition:border linear .2s,box-shadow linear .2s}.batch-add-error{color:red;margin-right:10px}<\/style>");t.show=function(n){var r=$.Deferred(),t,u;return $("body").append(i),t=$(".question-handle-dialog"),t.find("#survey-confirm-y").attr("choice","Y"),"N"===$(n).parents(".add-area").attr("choice")&&t.find("#survey-confirm-y").attr("choice","N"),t.find(".batch-choices").val(""),u=$(n).parents(".add-area").siblings(".question-title").find(".question-id").attr("order")-1,t.find("#survey-confirm-y").attr("question-id",u),t.find("#survey-confirm-y").click(function(){var u,y,v,a,o,s,h,f;if($(".batch-add-error").html(""),$.trim(t.find(".batch-choices").val())){var p=$.trim(t.find(".batch-choices").val()),i=p.split("\n"),e=$(n).parents(".topic-type-content"),l="",c=e.find(".question-title").attr("type");switch(c){case"6":l="radio";break;case"8":l="checkbox"}if(u="","6"===c||"8"===c){v=parseInt(e.find(".question-id").attr("absolute_id"));for(f in i)$.trim(i[f])&&(i[f]=i[f].replace(/<[^<]*>/g,""),choice_absolute_id[v]++,y=choice_absolute_id[v],u+='<li class="choice" has_other="N" choice_absolute_id='+y+'><input type="'+l+'" name="'+l+'"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true">'+i[f]+'<\/div><\/div><div class="option-tips"><\/div><\/li>');e.find(".question-choice").append(u);e.find(".question-choice").hasClass("select-ul")&&e.find(".question-choice").find(".choice").addClass("select_choice")}else if("9"===c)if("N"===$(this).attr("choice")){for(f in i)if($.trim(i[f])){for(i[f]=i[f].replace(/<[^<]*>/g,""),u+='<tr><td class="radio_array_title" name="radio-matrix"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true">'+i[f]+"<\/div><\/div><\/td>",a=e.find(".question-choice").find("tr:eq(0)").find("td").length,o=1;a>o;o++)u+='<td><input type="radio">',s=e.find(".question-choice").find("tr:eq(0)").find("td:eq("+o+")").find(".choice"),"Y"==s.attr("has_other")&&(u+='<input type="text" class="other-content"  style="width: 120px;height: 30px;vertical-align: middle;" >',1==s.attr("choice_required")&&(u+='<span class="required-content">(必填)<\/span>')),u+="<\/td>";u+="<\/tr>"}e.find(".question-choice").find("tr:eq(0)").clone();e.find(".question-choice").find("tbody").append(u)}else{h="";for(f in i)$.trim(i[f])&&(u+='<td name="radio-matrix-clone"><div class="position-relative"><li class="choice edit-area matrix-choice" has_other="N" contenteditable="true"  >'+i[f]+"<\/li><\/div><\/td>",h+='<td><input type="radio"><\/td>');e.find(".question-choice").find("tr:eq(0)").append(u);e.find(".question-choice").find("tr").each(function(){$(this).index()>0&&$(this).append(h)})}else if("13"===c)if("N"===$(this).attr("choice")){for(f in i)if($.trim(i[f])){for(i[f]=i[f].replace(/<[^<]*>/g,""),u+='<tr><td class="checkbox_array_title" name="checkbox-matrix"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true">'+i[f]+"<\/div><\/div><\/td>",a=e.find(".question-choice").find("tr:eq(0)").find("td").length,o=1;a>o;o++)u+='<td><input type="checkbox">',s=e.find(".question-choice").find("tr:eq(0)").find("td:eq("+o+")").find(".choice"),"Y"==s.attr("has_other")&&(u+='<input type="text" class="other-content"  style="width: 120px;height: 30px;vertical-align: middle;" >',1==s.attr("choice_required")&&(u+='<span class="required-content">(必填)<\/span>')),u+="<\/td>";u+="<\/tr>"}e.find(".question-choice").find("tr:eq(0)").clone();e.find(".question-choice").find("tbody").append(u)}else{h="";for(f in i)$.trim(i[f])&&(u+='<td name="checkbox-matrix-clone"><div class="position-relative"><li class="choice edit-area matrix-choice" has_other="N" contenteditable="true"  >'+i[f]+"<\/li><\/div><\/td>",h+='<td><input type="checkbox"><\/td>');e.find(".question-choice").find("tr:eq(0)").append(u);e.find(".question-choice").find("tr").each(function(){$(this).index()>0&&$(this).append(h)})}elementInit();e.find(".question-choice").hasClass("select-ul")||edit.saveSurvey();t.remove();r.resolve()}else t.find(".batch-add-error").html("输入内容不能为空！")}),t.find("#survey-confirm-n").click(function(){t.remove();r.reject()}),t.find(".close").click(function(){t.remove();r.reject()}),r.promise()}});edit=function(){function i(){$(".topic-type-content").each(function(){var o=$(this).index(),r,u,n,i,f,e,s;o+=1;$(this).find(".question-id").attr("order",o);r=$(this).prevAll(".topic-page").length;r+=1;$(this).find(".question-id").attr("page",r);u=$(this).find(".question-title").attr("name");n=$("#question-box").find(".topic-page").length;n+=1;"page"===u?($(this).find(".page-area").html("页码:"+r+"/"+n),i=0):"description"===u?i=0:(f=0,$(this).prevAll(".topic-type-question").each(function(){var n=parseInt($(this).find(".question-title").attr("type"),10);10!=n&&f++}),i=f+1,$(this).find(".question-id").html("Q"+i),"Y"==$(this).find(".question-id").attr("question-required")&&0==$(this).find(".required").length&&$(this).find(".question-id").before('<span class="required">*<\/span>'));$(this).find(".question-id").attr("index",i);$("#page-tail").html("页码:"+n+"/"+n);e=parseInt($(this).find(".question-title").attr("type"),10);(14===e||15===e)&&(s=$(this).find(".question-choice"),t(s.siblings(".add-area")))});var n=basePath+"/System/Api/Survey/UploadFile/0";$(".survey-question-upload-img-file").each(function(){$(this).fileupload({url:n,autoUpload:!0,sequentialUploads:!0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png|bmp)$/i,done:function(n,t){var i=$(this).parents(".add-area").siblings(".question-choice").find(".choice").length;50>i&&f($(this),t.result);edit.updateUploadItem($(this).parents(".add-area"))}})});$("img").load(function(){edit.updateUploadAll()})}function o(){$(".attach-left").css({top:$(".rows2").offset().top,width:$(".rows2").offset().left,height:$(".rows2").height(),left:0});$(".attach-right").css({top:$(".rows2").offset().top,right:0,width:$(window).width()-$(".rows2").offset().left-$(".rows2").width(),height:$(".rows2").height()})}function s(){redirect_relation&&$.each(redirect_relation,function(n,t){if($("#question-box").find('[absolute_id="'+n+'"]').parents(".question-title").siblings(".question-choice").find(".choice_show_logic_show_questions").remove(),$("#question-box").find('[absolute_id="'+n+'"]').parents(".question-title").find(".question-title-tip").remove(),t)if(t[0]){var r='<div class="question-title-tip">选中/填写任意项, ',i="";$.each(t[0],function(n,t){if(t>0)if(parseInt(n,10)<0)i=-1===parseInt(n,10)?"提前结束(计入结果)":"提前结束(不计入结果)";else{i="跳转";var r=$('[absolute_id="'+n+'"]').html();""==r&&(r=$('[absolute_id="'+n+'"]').next().find(".edit-area").text(),r='<a class="choice_show_logic_show_questions_link" title="'+r+'">'+r+"<\/a>");i+=r?r:""}});r+=i+"<\/div>";$("#question-box").find('[absolute_id="'+n+'"]').parents(".question-title").append(r)}else $.each(t,function(t,i){var r,u;i&&(r="",$.each(i,function(n,t){var u,i;t>0&&(parseInt(n,10)<0?(u=-1===parseInt(n,10)?"提前结束(计入结果)":"提前结束(不计入结果)",r='<span class="choice_show_logic_show_questions"><a class="choice_show_logic_show_questions_link" title="'+u+'">'+u+"<\/a>"):(r='<span class="choice_show_logic_show_questions">跳转',i=$('[absolute_id="'+n+'"]').html(),""==i&&(i=$('[absolute_id="'+n+'"]').next().find(".edit-area").text(),i='<a class="choice_show_logic_show_questions_link" title="'+i+'">'+i+"<\/a>"),r+=i?i:""))}),$("#question-box").find('[absolute_id="'+n+'"]').parents(".question-title").siblings(".question-choice").find('[choice_absolute_id="'+t+'"]').find(".choice_show_logic_show_questions").remove(),r+="<\/span>",u=$("#question-box").find('[absolute_id="'+n+'"]').parents(".question-title").attr("type"),r&&("6"==u||"8"==u||"14"==u||"15"==u)&&$("#question-box").find('[absolute_id="'+n+'"]').parents(".question-title").siblings(".question-choice").find('[choice_absolute_id="'+t+'"]').find(".option-tips").append(r))})})}function h(n){var t=[];return redirect_relation&&(redirect_relation[n]&&!$.isEmptyObject(redirect_relation[n])?inArray(n,t)||t.push(n):$.each(redirect_relation,function(i,r){r&&$.each(r,function(r,u){u&&$.each(u,function(r){parseInt(r,10)===parseInt(n,10)&&(inArray(i,t)||t.push(i))})})})),t}function c(){var u=$.Deferred(),f,i,e;if(ft(surveyTitle)){var o=arguments[0]?arguments[0]:0,s=arguments[1]?arguments[1]:0,t={};if(t.survey_id=survey_init.survey_id,t.survey_name=$.trim($(".title-content").text()),f=$(".desc-content").html().replace(/&nbsp;/gi," ").replace(/<br>/gi,"\n"),t.test_content=$.trim(f),t.status=o,t.content=[],t.redirect_relation=getRelation(),i=1,$(".topic-type-content").each(function(){var u={},f,c,o,s,h,e;u.survey_id=survey_init.survey_id;f=$(this).find(".qs-content").html();void 0!==f&&(f=f.replace(/&nbsp;/gi," ").replace(/<br>/gi,"\n"));""==f?($("html,body").animate({scrollTop:$(this).offset().top-50+"px"},500),$(this).find(".qs-content").trigger("focus"),i=0):u.content=$.trim(f);u.type_id=$(this).find(".question-title").attr("type");u.order=$(this).find(".question-id").attr("order");u.has_other=$(this).find(".question-id").attr("has_other");u.title_quote=$(this).find(".question-id").attr("title-quote");u.required=$(this).find(".question-id").attr("question-required");u.page=$(this).find(".question-id").attr("page");u.index=$(this).find(".question-id").attr("index");u.absolute_id=$(this).find(".question-id").attr("absolute_id");u.last_absolute_id=absolute_id;u.last_choice_absolute_id=choice_absolute_id;c=0;u.logic_hide=c;switch(u.type_id){case"6":case"14":(u.choice=n($(this),u.type_id),u.choice_quote=$(this).find(".question-id").attr("choice-quote"),0===parseInt(u.choice_quote)||isNaN(parseInt(u.choice_quote)))||(e=$("[absolute_id="+u.choice_quote+"]").attr("order"),u.choice=t.content[parseInt(e,10)-1].choice);break;case"8":case"15":o=$(this).find(".question-id").attr("min");u.min=""!==o&&"undefined"!==o&&null!==o&&void 0!==o?o:"";s=$(this).find(".question-id").attr("max");u.max=""!==s&&"undefined"!==s&&null!==s&&void 0!==s?s:"";h=$(this).find(".question-id").attr("exclusive-options");(u.exclusive_options=""!==h&&"undefined"!==h&&null!==h&&void 0!==h?h:"",u.choice=n($(this),u.type_id),u.choice_quote=$(this).find(".question-id").attr("choice-quote"),0===parseInt(u.choice_quote)||isNaN(parseInt(u.choice_quote)))||(e=$("[absolute_id="+u.choice_quote+"]").attr("order"),u.choice=t.content[parseInt(e,10)-1].choice);break;case"7":(u.choice=n($(this),u.type_id),u.choice_quote=$(this).find(".question-id").attr("choice-quote"),0===parseInt(u.choice_quote)||isNaN(parseInt(u.choice_quote)))||(e=$("[absolute_id="+u.choice_quote+"]").attr("order"),u.choice=t.content[parseInt(e,10)-1].choice);break;case"9":u.choice=n($(this),u.type_id);u.radio_array_title=r($(this),"radio_array_title");break;case"13":u.choice=n($(this),u.type_id);u.checkbox_array_title=r($(this),"checkbox_array_title");break;case"12":u.min="";u.max=4}t.content.push(u)}),0==i)return!1;e=basePath+"/System/Api/Survey/Design";$.post(e,{content:JSON.stringify(t)},function(n){n.success&&$(".time-save").css({top:$(window).scrollTop(),left:$(window).width()/2}).fadeIn(300).fadeOut(2e3);u.resolve()})}return u.promise()}function n(n,t){var r=[],i=/&NBSP;/gi;return n.find(".choice").each(function(){var n={},f,e,u;"9"==t||"13"==t?(n.order=$(this).parents("td").index(),u=$(this).html().replace(i,""),n.choice_absolute_id=$(this).parents("td").index()):"7"==t?(n.order=$(this).index()+1,u=$(this).html().replace(i,""),n.choice_absolute_id=$(this).attr("choice_absolute_id")):"14"==t?(n.order=$(this).index()+1,f=$(this).find(".edit-area").html().replace(i,""),e=$(this).find(".survey-question-radio-choice-img>img").attr("src"),u=f+"#**#"+e,n.choice_absolute_id=$(this).attr("choice_absolute_id")):"15"==t?(n.order=$(this).index()+1,f=$(this).find(".edit-area").html().replace(i,""),e=$(this).find(".survey-question-checkbox-choice-img>img").attr("src"),u=f+"#**#"+e,n.choice_absolute_id=$(this).attr("choice_absolute_id")):(n.order=$(this).index()+1,u=$(this).find(".edit-area").html().replace(i,""),n.choice_absolute_id=$(this).attr("choice_absolute_id"));n.content=u;n.is_other=$(this).attr("has_other");n.required=$(this).attr("choice_required");r.push(n)}),r}function r(n,t){var i=[];return n.find("."+t).each(function(){var n={};n.order=$(this).parent().index();n.content=$(this).find(".edit-area").html();i.push(n)}),i}function l(){var n=$("#question-box").find(".topic-type-content").length;n>3&&$("html, body").animate({scrollTop:$("#edit-survey-content").height()-200},"slow")}function u(){$(".topic-type-content").hover(function(){$(".add-area, .operate").not(".survey-question-upload-img-wrap").removeClass("visible-show").addClass("visible-hide");$(this).find(".add-area, .operate").not(".survey-question-upload-img-wrap").removeClass("visible-hide").addClass("visible-show")})}function a(n){var r=$(n).parents(".topic-type-content"),t;r.after(r.clone());t=parseInt(absolute_id)+1;$(n).parents(".topic-type-content").next().find(".question-id").attr("absolute_id",t);absolute_id++;$(n).parents(".topic-type-content").next().find(".choice_show_logic_show_questions").remove();choice_absolute_id[t]=0;$(n).parents(".topic-type-content").next().find(".choice").each(function(){$(this).attr("choice_absolute_id")>choice_absolute_id[t]&&(choice_absolute_id[t]=$(this).attr("choice_absolute_id"))});i();setUpdateStatus();u();elementInit()}function v(n){$("#question-box").append($(".edit-img"));require.async(["home:static/js/survey/widget/operate_popup.js"],function(t){t.show("删除此题卡","确定","取消").then(function(){var t=$(n).parents(".topic-type-content"),i=t.find(".question-id").attr("absolute_id");t.remove();edit.sortQuestions();edit.removeLogicCondition(i,t);setUpdateStatus()})})}function y(n){redirect_relation&&redirect_relation[n]&&!$.isEmptyObject(redirect_relation[n])&&(delete redirect_relation[n],$("#question-box").find('[absolute_id="'+n+'"]').parents(".question-title").siblings(".question-choice").find(".choice_show_logic_show_questions").remove(),$("#question-box").find('[absolute_id="'+n+'"]').parents(".question-title").find(".question-title-tip").remove(),edit.updateChoiceShowLogic())}function p(n){var t=$(n).parents(".operate").siblings(".question-title").attr("type"),i=$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("order");require.async(["home:static/js/survey/widget/question_handle.js"],function(r){r.show(n,t,i,"确定","取消")})}function f(n){var h=$(n).parents(".add-area").siblings(".question-title").attr("type"),t="",s=parseInt($(n).parents(".add-area").siblings(".question-title").find(".question-id").attr("absolute_id")),f,e,o,r,u,i;choice_absolute_id[s]++;f=choice_absolute_id[s];switch(h){case"6":i=$(n).parents(".add-area").siblings(".question-choice").find(".choice").length+1;t+='<li class="choice" has_other="N" choice_absolute_id='+f+'><input type="radio" name="radio"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项'+i+'<\/div><\/div><div class="option-tips"><\/div><\/li>';$(n).parents(".add-area").siblings(".question-choice").append(t);$(n).parents(".add-area").siblings(".question-choice").hasClass("select-ul")&&$(n).parents(".add-area").siblings(".question-choice").find(".choice").addClass("select_choice");break;case"14":e=arguments[1];i=$(n).parents(".add-area").siblings(".question-choice").find(".choice").length+1;t+='<li class="choice survey-question-radio-img" has_other="N" choice_absolute_id='+f+'><div class=survey-question-radio-choice> <div class=survey-question-radio-choice-img><a class="remove-child-element survey-question-radio-img-remove" onclick="edit.removeChildElement()"><\/a> <img src="'+e.img_url+'"> <\/div> <div class=survey-question-radio-choice-text> <input type=radio name=radio> <label class="edit-area edit-child-element" contenteditable=true>选项'+i+'<\/label> <div class="option-tips"><\/div><\/div> <\/div><\/li>';$(n).parents(".add-area").siblings(".question-choice").append(t);$(n).parents(".add-area").siblings(".question-choice").hasClass("select-ul")&&$(n).parents(".add-area").siblings(".question-choice").find(".choice").addClass("select_choice");break;case"15":e=arguments[1];i=$(n).parents(".add-area").siblings(".question-choice").find(".choice").length+1;t+='<li class="choice survey-question-checkbox-img" has_other="N" choice_absolute_id='+f+'><div class=survey-question-checkbox-choice> <div class=survey-question-checkbox-choice-img><a class="remove-child-element survey-question-checkbox-img-remove" onclick="edit.removeChildElement()"><\/a> <img src="'+e.img_url+'"> <\/div> <div class=survey-question-checkbox-choice-text> <input type=checkbox name=checkbox> <label class="edit-area edit-child-element" contenteditable=true>选项'+i+'<\/label> <div class="option-tips"><\/div><\/div> <\/div><\/li>';$(n).parents(".add-area").siblings(".question-choice").append(t);$(n).parents(".add-area").siblings(".question-choice").hasClass("select-ul")&&$(n).parents(".add-area").siblings(".question-choice").find(".choice").addClass("select_choice");break;case"8":i=$(n).parents(".add-area").siblings(".question-choice").find(".choice").length+1;t+='<li class="choice" has_other="N" choice_absolute_id='+f+'><input type="checkbox" name="checkbox"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项'+i+'<\/div><\/div><div class="option-tips"><\/div><\/li>';$(n).parents(".add-area").siblings(".question-choice").append(t);break;case"9":if("N"===$(n).parents(".add-area").attr("choice")){for(i=$(n).parents(".add-area").siblings(".question-choice").find("tr").length,t+='<tr><td class="radio_array_title" name="radio-matrix"> <div class="position-relative" style="width:100%"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">矩阵行'+i+"<\/div><\/div><\/td>",o=$(n).parents(".add-area").siblings(".question-choice").find("tr:eq(0)").find("td").length,r=1;o>r;r++)t+='<td><input type="radio">',u=$(n).parents(".add-area").siblings(".question-choice").find("tr:eq(0)").find("td:eq("+r+")").find(".choice"),"Y"==u.attr("has_other")&&(t+='<input type="text" class="other-content"  style="width: 120px;height: 30px;vertical-align: middle;" >',1==u.attr("choice_required")&&(t+='<span class="required-content">(必填)<\/span>')),t+="<\/td>";t+="<\/tr>";$(n).parents(".add-area").siblings(".question-choice").find("tbody").append(t)}else i=$(n).parents(".add-area").siblings(".question-choice").find("tr:eq(0)").find("td").length,t+='<td name="radio-matrix-choice"><div class="position-relative" style="width:100%"><li class="choice edit-area matrix-choice" has_other="N" contenteditable="true" content-default="1">选项'+i+"<\/li><\/div><\/td>",$(n).parents(".add-area").siblings(".question-choice").find("tr:eq(0)").append(t),$(n).parents(".add-area").siblings(".question-choice").find("tr").each(function(){$(this).index()>0&&$(this).append('<td><input type="radio"><\/td>')});break;case"13":if("N"===$(n).parents(".add-area").attr("choice")){for(i=$(n).parents(".add-area").siblings(".question-choice").find("tr").length,t+='<tr><td class="checkbox_array_title" name="checkbox-matrix"> <div class="position-relative" style="width:100%"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">矩阵行'+i+"<\/div><\/div><\/td>",o=$(n).parents(".add-area").siblings(".question-choice").find("tr:eq(0)").find("td").length,r=1;o>r;r++)t+='<td><input type="checkbox">',u=$(n).parents(".add-area").siblings(".question-choice").find("tr:eq(0)").find("td:eq("+r+")").find(".choice"),"Y"==u.attr("has_other")&&(t+='<input type="text" class="other-content"  style="width: 120px;height: 30px;vertical-align: middle;" >',1==u.attr("choice_required")&&(t+='<span class="required-content">(必填)<\/span>')),t+="<\/td>";t+="<\/tr>";$(n).parents(".add-area").siblings(".question-choice").find("tbody").append(t)}else i=$(n).parents(".add-area").siblings(".question-choice").find("tr:eq(0)").find("td").length,t+='<td name="checkbox-matrix-choice"><div class="position-relative" style="width:100%"><li class="choice edit-area matrix-choice" has_other="N" contenteditable="true" content-default="1">选项'+i+"<\/li><\/div><\/td>",$(n).parents(".add-area").siblings(".question-choice").find("tr:eq(0)").append(t),$(n).parents(".add-area").siblings(".question-choice").find("tr").each(function(){$(this).index()>0&&$(this).append('<td><input type="checkbox"><\/td>')})}elementInit();$(n).parents(".add-area").siblings(".question-choice").hasClass("select-ul")||setUpdateStatus()}function w(n){require.async(["home:static/js/survey/widget/batchAddChoice.js"],function(t){t.show(n,"确定","取消")})}function b(){var s=$(".edit-area-active").parents(".question-choice"),u=parseInt($(".edit-area-active").parents(".topic-type-question").find(".question-title").attr("type"),10),f,e,n,o,r,i;($("#question-box").append($(".edit-img")),$(".edit-area-active").parents("td").hasClass("radio_array_title")||$(".edit-area-active").parents("td").hasClass("checkbox_array_title"))?$(".edit-area-active").parents("tr").remove():$(".edit-area-active").hasClass("matrix-choice")?(f=$(".edit-area-active").parents("td").index(),$(".edit-area-active").parents("tr").siblings("tr").each(function(){$(this).find("td:eq("+f+")").remove()}),$(".edit-area-active").parents("td").remove()):(e=$(".edit-area-active").parents(".question-choice").children().length,e>1?(n=$(".edit-area-active").parents(".topic-type-question"),"8"===n.find(".question-title").attr("type")&&n.find(".question-id").attr("exclusive-options")&&(o=n.find(".question-id").attr("exclusive-options").split(","),r=[],$.each(o,function(n,t){t!==$(".edit-area-active").parents(".choice").attr("choice_absolute_id")&&r.push(t)}),n.find(".question-id").attr("exclusive-options",r.join(","))),i=n.find(".question-id").attr("absolute_id"),redirect_relation&&redirect_relation[i]&&!$.isEmptyObject(redirect_relation[i])?require.async(["home:static/js/survey/widget/sortable_popup.js"],function(t){t.show("该题有关联的逻辑规则，删除选项会导致规则失效，确认删除？","确定","取消").then(function(){$(".edit-area-active").parents(".choice").remove();edit.removeLogicCondition(i,n)})}):$(".edit-area-active").parents(".choice").remove()):showAlert("选项个数不能为0"));$(".edit-img").hide();(14===u||15===u)&&t(s.siblings(".add-area"));$(".edit-area-active").parent().hasClass("select_choice")||setUpdateStatus()}function k(){var n,t=!1,i;($(".edit-area-active").parents("td").hasClass("radio_array_title")||$(".edit-area-active").parents("td").hasClass("checkbox_array_title")?(n=$(".edit-area-active").parents("tr"),n.index()>1&&(t=!0)):(n=$(".edit-area-active").parents(".choice"),n.index()>0&&(t=!0)),t)&&(i=$(".edit-area-active").parents(".topic-type-question"),i.find(".question-id").attr("absolute_id"),n.prev().before(n),$(".edit-area-active").parent().hasClass("select_choice")||setUpdateStatus())}function d(){var n,t,i,r;$(".edit-area-active").parents("td").hasClass("radio_array_title")||$(".edit-area-active").parents("td").hasClass("checkbox_array_title")?(n=$(".edit-area-active").parents("tr"),t=$(".edit-area-active").parents(".question-choice").find("tr")):(n=$(".edit-area-active").parents(".choice"),t=$(".edit-area-active").parents(".question-choice").find(".choice"));i=n.index();i<t.length&&(r=$(".edit-area-active").parents(".topic-type-question"),r.find(".question-id").attr("absolute_id"),n.next().after(n),$(".edit-area-active").parent().hasClass("select_choice")||setUpdateStatus())}function g(){require.async(["home:static/js/survey/widget/choice_operate_dialog.js"],function(n){n.show("确定","取消")})}function nt(n){var t='<ul class="question-choice select-ul" >',i=$(n).siblings(".question-title").find(".question-id").attr("absolute_id"),r;$(n).siblings(".question-choice").find(".choice").each(function(){var r=$(this).attr("choice_absolute_id"),n;(t+='<li class="choice select_choice" has_other="N" choice_absolute_id='+$(this).attr("choice_absolute_id")+'><input type="radio" name="radio"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true">'+$(this).html()+"<\/div><\/div>",redirect_relation&&redirect_relation[i]&&!redirect_relation[i][0]&&redirect_relation[i][r])&&(n="",$.each(redirect_relation[i][r],function(t){if(parseInt(t,10)<0){var i=-1===parseInt(t,10)?"提前结束(计入结果)":"提前结束(不计入结果)";n='<div><span class="choice_show_logic_show_questions">'+i}else n='<div><span class="choice_show_logic_show_questions">跳转',n+=$('[absolute_id="'+t+'"]').html()+"&nbsp"}),n+="<\/span><\/div>",t+=n);t+="<\/li>"});t+="<\/ul>";$(n).siblings(".question-choice").remove();$(n).after(t);r='<div class="add-area visible-show"><ul><li class="add-choice" title="增加" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" title="批量增加" onclick="edit.batchAddChoice(this)"><\/li><li class="finish_edit_select" onclick="edit.finishEditSelect(this)" style="width: 60px;cursor: pointer;">完成编辑<\/li><\/ul><\/div>';$(n).siblings(".operate").before(r);$(n).siblings(".question-title").attr("type","6");$(n).remove();elementInit()}function tt(n){$("#question-box").append($(".edit-img"));var t='<select class="question-choice" style="  padding: 0;margin: 15px 0 20px 35px;">';$(n).parents(".add-area").siblings(".question-choice").find(".choice").each(function(){t+='<option class="choice" has_other="N" choice_absolute_id='+$(this).attr("choice_absolute_id")+">"+$(this).find(".edit-area").html()+"<\/option>"});t+='<\/select><span class="edit-select" onclick="edit.editSelect(this)" style="width: 60%;display: inline-block;line-height: 30px;">编辑选项<\/span>';$(n).parents(".add-area").siblings(".question-choice").remove();$(n).parents(".add-area").siblings(".question-title").after(t);$(n).parents(".add-area").siblings(".question-title").attr("type","7");$(n).parents(".add-area").remove();$(".edit-img").hide();setUpdateStatus()}function it(){$(".upload-form").ajaxSubmit({dataType:"json",success:function(n){var t=$(".edit-area-active").html();return t+='<img src="'+n.img_url+'" name="'+n.img_id+'"  style="width:'+n.width+"px; height:"+n.height+'px;"/>',$(".edit-area-active").html(t),$(".edit-area").find("img").each(function(){new ImgEditSize($(this))}),$(".upload-img").val(""),setUpdateStatus(),!1}})}function rt(n){return["单选题","选择列表","多选题","单行填空题","多行填空题","矩阵单选题","矩阵多选题","描述说明","图片单选题","图片多选题"].indexOf(n)>=0?!0:!1}function ut(n){return null===n.match(/^(选项|矩阵行)\d*$/g)?!1:!0}function ft(n){return 0==n.length?($("html,body").animate({scrollTop:$(".title-content").offset().top-50+"px"},500),$(".survey-title .error-tips").text("问卷名称不能为空"),!1):n.length>17?($("html,body").animate({scrollTop:$(".title-content").offset().top-50+"px"},500),$(".survey-title .error-tips").text("问卷名称不能超过17字"),!1):!0}function et(){$(".topic-type-question").each(function(){var n,t,i;8===parseInt($(this).find(".question-title").first().attr("type"),10)&&($(this).find(".exclusive-option-tip").remove(),n=$(this).find(".question-id").attr("exclusive-options"),n&&(t=n.split(","),i=$(this),$.each(t,function(n,t){i.find(".choice[choice_absolute_id="+t+"] .option-tips").append('<span class="exclusive-option-tip">与其他选项互斥<\/span>')})))})}function ot(){$(".survey-question-radio-choice").mouseenter(function(){$("div, td, li, label").removeClass("edit-area-active");$(this).hasClass("edit-area-active")||$(this).addClass("edit-area-active");$(".survey-question-radio-img-remove").hide();$(this).find(".survey-question-radio-img-remove").show()});$(".survey-question-radio-choice").mouseleave(function(){$(".survey-question-radio-img-remove").hide()});$(".survey-question-checkbox-choice").mouseenter(function(){$("div, td, li, label").removeClass("edit-area-active");$(this).hasClass("edit-area-active")||$(this).addClass("edit-area-active");$("div, td, li, label").removeClass("edit-area-active");$(this).hasClass("edit-area-active")||$(this).addClass("edit-area-active");$(".survey-question-checkbox-img-remove").hide();$(this).find(".survey-question-checkbox-img-remove").show()});$(".survey-question-checkbox-choice").mouseleave(function(){$(".survey-question-checkbox-img-remove").hide()})}function t(n){var t=n.siblings(".question-choice").find(".choice").length;50>t?n.show():n.hide();e()}function e(){$(".survey-question-upload-img-wrap").each(function(){var i=$(this).siblings(".question-choice").find(".choice").length;if(i%4==0)$(this).css("position","relative").css("left",0).css("top",0);else{var n=$(this).siblings(".question-choice").find(".choice:last"),t=n.offset(),r=t.left+n.width()-35+"px",u=t.top-57+"px";$(this).css("position","absolute").css("left",r).css("top",u)}})}function st(){$(".topic-type-question").each(function(){var r=parseInt($(this).find(".question-title").first().attr("type"),10),f,e,u,n;if(6===r||7===r||8===r)if(f=parseInt($(this).find(".question-id").attr("choice-quote"),10),0===f||isNaN(f)){if($(this).find(".choice-quote-tip").length>0){$(this).find(".question-title").siblings().remove();var n="",i=$(this).find(".question-id").attr("absolute_id"),t=choice_absolute_id[i];switch(r){case 7:for(n+='<select class="question-choice" style="  padding: 0;margin: 15px 0 20px 35px;">',e=1;4>e;e++)choice_absolute_id[i]++,t=choice_absolute_id[i],n+='<option class="choice" has_other="N" choice_absolute_id='+t+">选项"+e+"<\/option>";n+='<\/select><span class="edit-select" style="  width: 60%;display: inline-block;line-height: 30px;" onclick="edit.editSelect(this)">编辑选项<\/span>';n+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case 6:n+='<ul class="question-choice"><li class="choice" has_other="N" choice_absolute_id='+t+' ><input type="radio" name="radio"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项1 <\/div><\/div><div class="option-tips"><\/div><\/li>';choice_absolute_id[i]++;t=choice_absolute_id[i];n+='<li class="choice" has_other="N" choice_absolute_id='+t+'><input type="radio" name="radio"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项2 <\/div><div><\/li><div class="option-tips"><\/div><\/ul>';n+='<div class="add-area visible-hide"><ul><li class="add-choice" title="增加" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" title="批量增加" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';n+='<div class="operate visible-hide" ><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';break;case 8:n+='<ul class="question-choice"><li class="choice" has_other="N" choice_absolute_id='+t+'><input type="checkbox" name="checkbox"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项1 <\/div><\/div><div class="option-tips"><\/div><\/li>';choice_absolute_id[i]++;t=choice_absolute_id[i];n+='<li class="choice" has_other="N" choice_absolute_id='+t+'><input type="checkbox" name="checkbox"><div class="position-relative"><div class="edit-area edit-child-element" contenteditable="true" content-default="1">选项2 <\/div><\/div><div class="option-tips"><\/div><\/li><\/ul>';n+='<div class="add-area visible-hide"><ul><li class="add-choice" title="增加" onclick="edit.addQuestion(this)"><\/li><li class="batch-add-choice" title="批量增加" onclick="edit.batchAddChoice(this)"><\/li><\/ul><\/div>';n+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="set-logic" title="逻辑设置" onclick="setLogic(this)"><li class="question-copy" title="复制" onclick="edit.questionCopy(this)"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>'}$(this).find(".question-title").after(n)}}else{$(this).find(".question-title").siblings().remove();u="";switch(r){case 6:u="单选题";break;case 7:u="下拉选择题";break;case 8:u="多选题"}n='<div class="choice-quote-tip">&lt;'+u+"&gt此题目选项来自于"+$('[absolute_id="'+f+'"]').html()+"题中的选项<\/div>";n+='<div class="operate visible-hide"><ul><li class="drag-area" title="移动"><\/li><li class="question-handle" title="操作" onclick="edit.questionHandle(this)"><\/li><li class="question-delete" title="删除" onclick="edit.questionDelete(this)"><\/li><\/ul><\/div>';$(this).find(".question-title").after(n)}})}return{sortQuestions:i,attachLayer:o,updateChoiceShowLogic:s,checkQuestionLogic:h,saveSurvey:c,scrollBox:l,visibleHandle:u,removeLogicCondition:y,questionHandle:p,questionCopy:a,questionDelete:v,addQuestion:f,batchAddChoice:w,removeChildElement:b,upChildElement:k,downChildElement:d,handleChildElement:g,editSelect:nt,finishEditSelect:tt,uploadImg:it,isDefaultQuestion:rt,isDefaultChoice:ut,showExclusiveOptions:et,updateByChoiceQuote:st,updateQuestionType:ot,updateUploadItem:t,updateUploadAll:e}}();showAlert=function(n){require.async(["home:static/js/survey/widget/operate_popup.js"],function(t){t.show(n,"确定",null)})};define("home:static/js/survey/widget/edit_logic_pop.js",function(n,t){"use strict";var r='<div class=logic-popup><div class=logic-area> <div class=logic-area-title>逻辑设置<span class=close>&times;<\/span><\/div> <div class=logic-area-content> <div style="width:165px;margin-right:5px;float:left;"><span class="logic-area-condition-title">当前用户选择:<\/span><div class=logic-area-condition> <div class=condition-area> <\/div> <\/div><\/div> <div style="float:left;width:230px;padding-left:20px"><span class="logic-area-condition-title">则<span style="color: red;">跳转<\/span>以下题目<\/span> <div class=logic-area-question> <div class=logic-questions> <\/div> <\/div><\/div> <\/div> <div class=logic-area-button> <input type=button class="dialog-button-survey button-confirm" value="确定">&nbsp; <input type=button class="dialog-button-survey button-cancel" value="取消"> <\/div> <\/div> <div class=survey-mask><\/div><\/div>',i;$("body").append("<style>.logic-area{font-size:14px;font-family:微软雅黑;position:fixed;left:50%;top:10%;width:500px;height:450px;margin-left:-250px;background:#fff;border-radius:4px;border:1px solid #f6f9fe;z-index:1003}.logic-area-title{height:40px;line-height:40px;padding-left:16px;color:#2c4a93;background:#f1f5fd;border-bottom:1px solid #b0c0e7}.logic-area-content{margin:40px;color:#666;height:270px}.survey-mask{position:fixed;height:100%;width:100%;background:#aaa;z-index:1002;top:0;left:0;opacity:.5;filter:alpha(opacity:50)}.button{width:64px;height:30px;border-radius:3px;background:#f1f5fd;border:1px solid #b0c0e7;color:#2c4a93;cursor:pointer}.button:hover{background:#f1f5fd;border:1px solid #6583cc;color:#2c4a93}.button-confirm{background:#249cfa;border:1px solid #249cfa;color:#fff;text-align:center}.button-confirm:hover{background:#48aefe;border:1px solid #48aefe;color:#fff}.close{font-size:18px;line-height:40px!important;font-weight:700;color:#666;float:right;padding-right:16px;cursor:pointer}.logic-area-button{width:500px;height:30px;margin:30px 0 40px 0;text-align:center}.logic-area-condition{font-size: 12px;width:165px;height:240px;float:left;border:1px solid #b0c0e7;margin-right:5px;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;padding:15px 0 15px 0;overflow-y:auto;overflow-x:hidden}.logic-area-question{font-size: 12px;width:230px;height:240px;float:left;border:1px solid #b0c0e7;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;padding:15px 0 15px 15px;overflow-y:auto;overflow-x:hidden}.logic-area-condition-title{padding:0 0 0 10px}.condition-active{background-color:#dbdbdb}.condition-area{cursor:pointer}.logic-show-checkbox{margin-right:5px!important}.logic-show-question label{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;width:215px;display:block}.condition_element{padding:0 0 0 15px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block}<\/style>");i=[{absolute_id:"-1",name:"提前结束(计入结果)"},{absolute_id:"-2",name:"提前结束(不计入结果)"}];t.show=function(n){function s(){var t,u,i,r,f,e;$(".condition-active").length>0&&(t=parseInt($(".condition-active").attr("absolute_id")),u=parseInt($(".condition-active").attr("choice_absolute_id")),redirect_relation[t]||(redirect_relation[t]={}),r=[],f=!1,0===parseInt(u,10)?(r.push("0"),$(n).parents(".operate").siblings(".question-choice").find(".choice").each(function(){r.push($(this).attr("choice_absolute_id"))}),f=!0):r.push(u),e=!1,$(".logic-show-question").each(function(){$(this).find(".logic-show-checkbox").is(":checked")&&(e=!0)}),$.each(r,function(n,r){if(f!==!0||e!==!1||0==r){var u="";$(".logic-show-question").each(function(){if(i=parseInt($(this).attr("absolute_id")),redirect_relation[t][r]||(redirect_relation[t][r]={}),$(this).find(".logic-show-checkbox").is(":checked")){redirect_relation[t][r]={};redirect_relation[t][r][i]=1;u=i>0?'<span class="choice_show_logic_show_questions">跳转':'<span class="choice_show_logic_show_questions">';var n=$(this).find(".logic_show_question_index").html();""==n&&(n=$(this).find(".logic_show_question_index").parent().text(),n='<a class="choice_show_logic_show_questions_link" title="'+n+'">'+n+"<\/a>");u+=n}else redirect_relation[t][r]&&redirect_relation[t][r][i]&&delete redirect_relation[t][r][i],$.isEmptyObject(redirect_relation[t][r])&&delete redirect_relation[t][r]});u+="<\/span>";$("#question-box").find('[absolute_id="'+t+'"]').parents(".question-title").siblings(".question-choice").find('[choice_absolute_id="'+r+'"]').find(".choice_show_logic_show_questions").remove();u&&7!=$("#question-box").find('[absolute_id="'+t+'"]').parents(".question-title").attr("type")&&$("#question-box").find('[absolute_id="'+t+'"]').parents(".question-title").siblings(".question-choice").find('[choice_absolute_id="'+r+'"]').find(".option-tips").append(u)}}))}var e=$.Deferred(),u,f;$("body").append(r);var t=$(".logic-popup"),o="<ul> ",h=$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("absolute_id"),c=$(n).parents(".operate").siblings(".question-title").attr("type");o+='<li class="condition_element" absolute_id='+h+' choice_absolute_id=0 title="任意选项">任意选项<\/li>';$(n).parents(".operate").siblings(".question-choice").find(".choice").each(function(){var n,t;"7"==c?(n=$(this).text(),t=$(this).html()):(n=$(this).find(".edit-area").text(),t=$(this).find(".edit-area").html());""==$.trim(n)&&t.indexOf("img")>=0&&(n="【图片】");o+='<li class="condition_element" absolute_id='+h+" choice_absolute_id="+$(this).attr("choice_absolute_id")+' title="'+n+'">'+n+"<\/li>"});o+="<\/ul>";t.find(".condition-area").html(o);u="<ul>";$(n).parents(".topic-type-content").nextAll(".topic-type-content").length>0&&$(n).parents(".topic-type-content").nextAll(".topic-type-content").each(function(){if("11"!=$(this).find(".question-title").attr("type")){var n,t;n=$(this).find(".edit-title").text();t=$(this).find(".edit-title").html();""==$.trim(n)&&t.indexOf("img")>=0&&(n="【图片】");u+='<li class="logic-show-question"  absolute_id='+$(this).find(".question-id").attr("absolute_id")+' title="'+$(this).find(".question-id").text()+n+'"><label><input type="radio" name="redirect-radio" class="logic-show-checkbox logic-show-checkbox-'+$(this).find(".question-id").attr("absolute_id")+'" style="margin: 3px 0 0 1px;"><span class="logic_show_question_index">'+$(this).find(".question-id").text()+"<\/span>"+n+"<\/label><\/li>"}});for(f in i)u+='<li class="logic-show-question"  absolute_id='+i[f].absolute_id+' title="'+i[f].name+'"><label><input type="radio" name="redirect-radio" class="logic-show-checkbox logic-show-checkbox-'+i[f].absolute_id+'" style="margin: 3px 0 0 1px;"><span class="logic_show_question_index"><\/span>'+i[f].name+"<\/label><\/li>";return u+='<\/ul><div class="dialog-button-survey cancel-redirect-button" style="text-align: center">取消选择<\/div>',t.find(".logic-questions").html(u),t.find(".button-confirm").click(function(){s();edit.saveSurvey();t.remove();e.resolve()}),t.find(".button-cancel").click(function(){t.remove();e.reject()}),t.find(".close").click(function(){t.remove();e.reject()}),t.find(".cancel-redirect-button").click(function(){$(".logic-show-checkbox").prop("checked",!1)}),t.find(".condition_element").click(function(){s();$(".logic-show-checkbox").attr("checked",!1);$(".condition_element").removeClass("condition-active");$(this).addClass("condition-active");var n,t;n=parseInt($(".condition-active").attr("absolute_id"));t=parseInt($(".condition-active").attr("choice_absolute_id"));redirect_relation[n]&&redirect_relation[n][t]&&$.each(redirect_relation[n][t],function(n,t){t>0&&$(".logic-show-checkbox-"+n).prop("checked",!0)})}),$(".condition_element:eq(0)").trigger("click"),e.promise()}});define("home:static/js/survey/widget/choice_operate_dialog.js",function(n,t){"use strict";var i='<div class=operate-popup><div class=survey-choice-confirm> <div class=survey-choice-confirm-title>选项设置<span class=close>&times;<\/span><\/div> <div class=survey-choice-confirm-content> <ul> <li> <label> <input type=checkbox name=add-other class=add-other> <span>&nbsp;选项后增加填空框<\/span> <\/label>  <li> <label> <input type=checkbox name=choice-no-required class=choice-no-required> <span>该选项可跳过不答<\/span> <\/label>  <\/ul> <\/div> <div class=survey-choice-confirm-button> <input type=button class="dialog-button-survey button-confirm" id=survey-choice-confirm-y value="确定">&nbsp; <input type=button class="dialog-button-survey button-cancel" id=survey-choice-confirm-n value="取消"> <\/div> <\/div> <div class=survey-choice-mask><\/div><\/div>';$("body").append("<style>.survey-choice-confirm{font-size:14px;font-family:微软雅黑;position:fixed;left:50%;top:40%;width:500px;height:220px;margin-left:-250px;background:#fff;border-radius:4px;border:1px solid #f6f9fe;z-index:1003}.survey-choice-confirm-title{height:40px;line-height:40px;padding-left:16px;color:#2c4a93;background:#f1f5fd;border-bottom:1px solid #b0c0e7}.survey-choice-confirm-content{margin:15px;color:#666;min-height:80px}.survey-choice-confirm-content ul{padding:0}.survey-choice-confirm-content ul li{list-style:none}.survey-choice-confirm-button{text-align:center;height:20px;line-height:20px}.survey-choice-mask{position:fixed;height:100%;width:100%;background:#aaa;z-index:1002;top:0;left:0;opacity:.5;filter:alpha(opacity:50)}.button{width:64px;height:30px;line-height:20px;border-radius:3px;background:#f1f5fd;border:1px solid #b0c0e7;color:#2c4a93;cursor:pointer}.button:hover{background:#f1f5fd;border:1px solid #6583cc;color:#2c4a93}.button-confirm{background:#249cfa;border:1px solid #249cfa;color:#fff}.button-confirm:hover{background:#48aefe;border:1px solid #48aefe;color:#fff}.close{font-size:18px;line-height:40px!important;font-weight:700;color:#666;float:right;padding-right:16px;cursor:pointer}.add-other{margin:0!important}<\/style>");t.show=function(n,t){var u=$.Deferred(),f,e,r;return $("body").append(i),r=$(".operate-popup"),$(".edit-area-active").hasClass("matrix-choice")?(f=$(".edit-area-active").attr("has_other"),e=$(".edit-area-active").attr("choice_required")):(f=$(".edit-area-active").parents(".choice").attr("has_other"),e=$(".edit-area-active").parents(".choice").attr("choice_required")),$(".add-other").change(function(){$(".add-other").is(":checked")?$(".choice-no-required").parents("li").show():$(".choice-no-required").parents("li").hide();$(".choice-no-required").prop("checked",!0)}),"Y"==f?$(".add-other").prop("checked",!0):($(".add-other").prop("checked",!1),$(".choice-no-required").parents("li").hide()),0===parseInt(e,10)?$(".choice-no-required").prop("checked",!0):$(".choice-no-required").prop("checked",!1),"Confirm"!=n&&(null===n?r.find("#survey-choice-confirm-y").hide():r.find("#survey-choice-confirm-y").val(n)),"Cancel"!=t&&(null===t?r.find("#survey-choice-confirm-n").hide():r.find("#survey-choice-confirm-n").val(t)),r.find("#survey-choice-confirm-y").click(function(){var t,i,f,n,e;t=$(".edit-area-active").hasClass("matrix-choice")?$(".edit-area-active"):$(".edit-area-active").parents(".choice");i="";f='<input type="text" class="other-content"  style="width: 120px;height: 30px; vertical-align: middle;">';$(".add-other").is(":checked")?(t.attr("has_other","Y"),$(".choice-no-required").is(":checked")?(i="",t.attr("choice_required",0)):(i='<span class="required-content">(必填)<\/span>',t.attr("choice_required",1)),$(".edit-area-active").hasClass("matrix-choice"))?($(".edit-area-active").parents("td").find(".other-content").remove(),n=$(".edit-area-active").parents("td").index(),$(".edit-area-active").parents("tr").siblings().each(function(){$(this).find("td:eq("+n+")").find(".other-content").remove();$(this).find("td:eq("+n+")").find(".required-content").remove();$(this).find("td:eq("+n+")").append(f+i)})):($(".edit-area-active").parents(".choice").find(".other-content").remove(),$(".edit-area-active").parents(".choice").find(".required-content").remove(),$(".edit-area-active").parents(".choice").find(".position-relative").after(f+i)):(t.attr("has_other","N"),t.attr("choice_required",0),$(".edit-area-active").hasClass("matrix-choice"))?(n=$(".edit-area-active").parents("td").index(),$(".edit-area-active").parents("tr").siblings().each(function(){$(this).find("td:eq("+n+")").find(".other-content").remove();$(this).find("td:eq("+n+")").find(".required-content").remove()})):($(".edit-area-active").parents(".choice").find(".other-content").remove(),$(".edit-area-active").parents(".choice").find(".required-content").remove());e=0;$(".edit-area-active").parents(".question-choice").find(".choice").each(function(){"Y"==$(this).attr("has_other")&&(e+=1)});e>0?$(".edit-area-active").parents(".question-choice").siblings(".question-title").find(".question-id").attr("has_other","Y"):$(".edit-area-active").parents(".question-choice").siblings(".question-title").find(".question-id").attr("has_other","N");edit.saveSurvey();r.remove();u.resolve()}),r.find("#survey-choice-confirm-n").click(function(){r.remove();u.reject()}),r.find(".close").click(function(){r.remove();u.reject()}),u.promise()}});define("home:static/js/survey/widget/operate_popup.js",function(n,t){"use strict";var i='<div class="operate-popup">  <div class="survey-confirm"><div class="survey-confirm-title">操作提示<span class="close">&times;<\/span><\/div><div class="survey-confirm-content"><img src="/Content/Survey/images/warning_icon.png" style="vertical-align: middle;"><div class="survey-content-text">确定进入下一步吗？<\/div><\/div><div class="survey-confirm-button"><input type="button" class="button button-confirm" id="survey-confirm-y" value="确定">&nbsp;<input type="button" class="button button-cancel" id="survey-confirm-n" value="取消"><\/div><\/div><div class="survey-mask"><\/div><\/div>';$("body").append("<style>.survey-confirm{font-size:14px;font-family:微软雅黑;position:fixed;left:50%;top:20%;width:500px;margin-left:-250px;background:#fff;border-radius:4px;border:1px solid #f6f9fe;z-index:1003}.survey-confirm-title{height:40px;line-height:40px;padding-left:16px;color:#2c4a93;background:#f1f5fd;border-bottom:1px solid #b0c0e7}.survey-confirm-content{margin:40px 40px 20px 40px;text-align:center;color:#666}.survey-confirm-button{text-align:center;height:20px;line-height:20px;margin-bottom:40px;font-size:0}.survey-mask{position:fixed;height:100%;width:100%;background:#aaa;z-index:1002;top:0;left:0;opacity:.5;filter:alpha(opacity:50)}.survey-confirm .button{width:64px;height:30px;line-height:26px;border-radius:3px;background:#f1f5fd;border:1px solid #b0c0e7;color:#2c4a93;cursor:pointer;font-size:12px;}.survey-confirm .button:hover{background:#f1f5fd;border:1px solid #6583cc;color:#2c4a93}.survey-confirm .button-confirm{background:#249cfa;border:1px solid #249cfa;color:#fff;margin-right:6px}.survey-confirm .button-confirm:hover{background:#48aefe;border:1px solid #48aefe;color:#fff}.close{font-size:18px;line-height:40px!important;font-weight:700;color:#666;float:right;padding-right:16px;cursor:pointer}.survey-confirm-content span{vertical-align:text-bottom}.survey-content-text{display:inline-block;vertical-align:middle;text-align:left;margin-left:16px;max-width:362px;}<\/style>");t.show=function(n,t,r){var f=$.Deferred(),u;return $("body").append(i),u=$(".operate-popup"),u.find(".survey-confirm-content div").html(n),u.find(".survey-confirm-content img").attr("src","/Content/Survey/images/warning_icon.png"),"Confirm"!=t&&(null===t?u.find("#survey-confirm-y").hide():u.find("#survey-confirm-y").val(t)),"Cancel"!=r&&(null===r?u.find("#survey-confirm-n").hide():u.find("#survey-confirm-n").val(r)),u.find("#survey-confirm-y").click(function(){u.remove();f.resolve()}),u.find("#survey-confirm-n").click(function(){u.remove();f.reject()}),u.find(".close").click(function(){u.remove();f.reject()}),f.promise()}}),function(n,t,i){"use strict";function f(n,t,i){var u=n.runtimeStyle&&n.runtimeStyle[t],f,r=n.style;return(!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(i)&&/^-?\d/.test(i)&&(f=r.left,u&&(n.runtimeStyle.left=n.currentStyle.left),r.left=t==="fontSize"?"1em":i||0,i=r.pixelLeft+"px",r.left=f,u&&(n.runtimeStyle.left=u)),!/^(thin|medium|thick)$/i.test(i))?Math.round(parseFloat(i))+"px":i}function s(n){return parseInt(n,10)}function h(n,t,u,e){if(n=(n||"").split(","),n=n[e||0]||n[0]||"auto",n=r.Util.trimText(n).split(" "),u!=="backgroundSize"||n[0]&&!n[0].match(/cover|contain|auto/)){if(n[0]=n[0].indexOf("%")===-1?f(t,u+"X",n[0]):n[0],n[1]===i){if(u==="backgroundSize")return n[1]="auto",n;n[1]=n[0]}n[1]=n[1].indexOf("%")===-1?f(t,u+"Y",n[1]):n[1]}return n}function e(n,t,i,u,f,e){var o=r.Util.getCSS(t,n,f),h,s,c,l,a;return o.length===1&&(l=o[0],o=[],o[0]=l,o[1]=l),o[0].toString().indexOf("%")!==-1?(c=parseFloat(o[0])/100,s=i.width*c,n!=="backgroundSize"&&(s-=(e||u).width*c)):n==="backgroundSize"?o[0]==="auto"?s=u.width:/contain|cover/.test(o[0])?(a=r.Util.resizeBounds(u.width,u.height,i.width,i.height,o[0]),s=a.width,h=a.height):s=parseInt(o[0],10):s=parseInt(o[0],10),o[1]==="auto"?h=s/u.width*u.height:o[1].toString().indexOf("%")!==-1?(c=parseFloat(o[1])/100,h=i.height*c,n!=="backgroundSize"&&(h-=(e||u).height*c)):h=parseInt(o[1],10),[s,h]}function c(n,t){var i=[];return{storage:i,width:n,height:t,clip:function(){i.push({type:"function",name:"clip",arguments:arguments})},translate:function(){i.push({type:"function",name:"translate",arguments:arguments})},fill:function(){i.push({type:"function",name:"fill",arguments:arguments})},save:function(){i.push({type:"function",name:"save",arguments:arguments})},restore:function(){i.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){i.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){i.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var n=[];return i.push({type:"function",name:"drawShape",arguments:n}),{moveTo:function(){n.push({name:"moveTo",arguments:arguments})},lineTo:function(){n.push({name:"lineTo",arguments:arguments})},arcTo:function(){n.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){n.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){n.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){i.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){i.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(n,t){return i.push({type:"variable",name:n,arguments:t}),t}}}function l(n){return{zindex:n,children:[]}}var r={},o,u;r.Util={};r.Util.log=function(t){r.logging&&n.console&&n.console.log&&n.console.log(t)};r.Util.trimText=function(n){return function(t){return n?n.apply(t):((t||"")+"").replace(/^\s+|\s+$/g,"")}}(String.prototype.trim);r.Util.asFloat=function(n){return parseFloat(n)},function(){var n=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,t=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;r.Util.parseTextShadows=function(i){var u,e,f,r;if(!i||i==="none")return[];for(u=i.match(n),e=[],f=0;u&&f<u.length;f++)r=u[f].match(t),e.push({color:r[0],offsetX:r[1]?r[1].replace("px",""):0,offsetY:r[2]?r[2].replace("px",""):0,blur:r[3]?r[3].replace("px",""):0});return e}}();r.Util.parseBackgroundImage=function(n){var i,r,l,a,e,v=[],t,u=0,o=0,f,s,h=function(){i&&(r.substr(0,1)==='"'&&(r=r.substr(1,r.length-2)),r&&s.push(r),i.substr(0,1)==="-"&&(a=i.indexOf("-",1)+1)>0&&(l=i.substr(0,a),i=i.substr(a)),v.push({prefix:l,method:i.toLowerCase(),value:e,args:s}));s=[];i=l=r=e=""},c,y;for(h(),c=0,y=n.length;c<y;c++)if(t=n[c],u!==0||!(" \r\n\t".indexOf(t)>-1)){switch(t){case'"':f?f===t&&(f=null):f=t;break;case"(":if(f)break;else if(u===0){u=1;e+=t;continue}else o++;break;case")":if(f)break;else if(u===1)if(o===0){u=0;e+=t;h();continue}else o--;break;case",":if(f)break;else if(u===0){h();continue}else if(u===1&&o===0&&!i.match(/^url$/i)){s.push(r);r="";e+=t;continue}}e+=t;u===0?i+=t:r+=t}return h(),v};r.Util.Bounds=function(n){var t,i={};return n.getBoundingClientRect&&(t=n.getBoundingClientRect(),i.top=t.top,i.bottom=t.bottom||t.top+t.height,i.left=t.left,i.width=n.offsetWidth,i.height=n.offsetHeight),i};r.Util.OffsetBounds=function(n){var t=n.offsetParent?r.Util.OffsetBounds(n.offsetParent):{top:0,left:0};return{top:n.offsetTop+t.top,bottom:n.offsetTop+n.offsetHeight+t.top,left:n.offsetLeft+t.left,width:n.offsetWidth,height:n.offsetHeight}};r.Util.getCSS=function(n,i,r){var e,f;return(o!==n&&(u=t.defaultView.getComputedStyle(n,null)),e=u[i],/^background(Size|Position)$/.test(i))?h(e,n,i,r):/border(Top|Bottom)(Left|Right)Radius/.test(i)?(f=e.split(" "),f.length<=1&&(f[1]=f[0]),f.map(s)):e};r.Util.resizeBounds=function(n,t,i,r,u){var s=i/r,o=n/t,f,e;return u&&u!=="auto"?s<o^u==="contain"?(e=r,f=r*o):(f=i,e=i/o):(f=i,e=r),{width:f,height:e}};r.Util.BackgroundPosition=function(n,t,i,r,u){var f=e("backgroundPosition",n,t,i,r,u);return{left:f[0],top:f[1]}};r.Util.BackgroundSize=function(n,t,i,r){var u=e("backgroundSize",n,t,i,r);return{width:u[0],height:u[1]}};r.Util.Extend=function(n,t){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t};r.Util.Children=function(n){var t;try{t=n.nodeName&&n.nodeName.toUpperCase()==="IFRAME"?n.contentDocument||n.contentWindow.document:function(n){var t=[];return n!==null&&function(n,t){var u=n.length,r=0,f;if(typeof t.length=="number")for(f=t.length;r<f;r++)n[u++]=t[r];else while(t[r]!==i)n[u++]=t[r++];return n.length=u,n}(t,n),t}(n.childNodes)}catch(u){r.Util.log("html2canvas.Util.Children failed with exception: "+u.message);t=[]}return t};r.Util.isTransparent=function(n){return n==="transparent"||n==="rgba(0, 0, 0, 0)"};r.Util.Font=function(){var n={};return function(t,r,u){if(n[t+"-"+r]!==i)return n[t+"-"+r];var f=u.createElement("div"),e=u.createElement("img"),o=u.createElement("span"),h="Hidden Text",c,l,s;return f.style.visibility="hidden",f.style.fontFamily=t,f.style.fontSize=r,f.style.margin=0,f.style.padding=0,u.body.appendChild(f),e.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",e.width=1,e.height=1,e.style.margin=0,e.style.padding=0,e.style.verticalAlign="baseline",o.style.fontFamily=t,o.style.fontSize=r,o.style.margin=0,o.style.padding=0,o.appendChild(u.createTextNode(h)),f.appendChild(o),f.appendChild(e),c=e.offsetTop-o.offsetTop+1,f.removeChild(o),f.appendChild(u.createTextNode(h)),f.style.lineHeight="normal",e.style.verticalAlign="super",l=e.offsetTop-f.offsetTop+1,s={baseline:c,lineWidth:1,middle:l},n[t+"-"+r]=s,u.body.removeChild(f),s}}(),function(){function u(n){return function(t){try{n.addColorStop(t.stop,t.color)}catch(i){f.log(["failed to add color stop: ",i,"; tried to add: ",t])}}}var f=r.Util,n={},i;r.Generate=n;i=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];n.parseGradient=function(n,t){for(var r,p=i.length,o,h,u,s,c,e,l,a,v,y,f=0;f<p;f+=1)if(o=n.match(i[f]),o)break;if(o)switch(o[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(r={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},u=o[2].match(/\w+/g),u)for(s=u.length,f=0;f<s;f+=1)switch(u[f]){case"top":r.y0=0;r.y1=t.height;break;case"right":r.x0=t.width;r.x1=0;break;case"bottom":r.y0=t.height;r.y1=0;break;case"left":r.x0=0;r.x1=t.width}if(r.x0===null&&r.x1===null&&(r.x0=r.x1=t.width/2),r.y0===null&&r.y1===null&&(r.y0=r.y1=t.height/2),u=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g),u)for(s=u.length,c=1/Math.max(s-1,1),f=0;f<s;f+=1)e=u[f].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),h=e[2]?parseFloat(e[2])/(e[3]==="%"?100:t.width):f*c,r.colorStops.push({color:e[1],stop:h});break;case"-webkit-gradient":if(r={type:o[2]==="radial"?"circle":o[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},u=o[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/),u&&(r.x0=u[1]*t.width/100,r.y0=u[2]*t.height/100,r.x1=u[3]*t.width/100,r.y1=u[4]*t.height/100),u=o[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g),u)for(s=u.length,f=0;f<s;f+=1)e=u[f].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),h=parseFloat(e[2]),e[1]==="from"&&(h=0),e[1]==="to"&&(h=1),r.colorStops.push({color:e[3],stop:h});break;case"-moz-linear-gradient":if(r={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},u=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),u&&(r.x0=u[1]*t.width/100,r.y0=u[2]*t.height/100,r.x1=t.width-r.x0,r.y1=t.height-r.y0),u=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g),u)for(s=u.length,c=1/Math.max(s-1,1),f=0;f<s;f+=1)e=u[f].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),e[2]?(h=parseFloat(e[2]),e[3]&&(h/=100)):h=f*c,r.colorStops.push({color:e[1],stop:h});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(r={type:"circle",x0:0,y0:0,x1:t.width,y1:t.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},u=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),u&&(r.cx=u[1]*t.width/100,r.cy=u[2]*t.height/100),u=o[3].match(/\w+/),e=o[4].match(/[a-z\-]*/),u&&e)switch(e[0]){case"farthest-corner":case"cover":case"":l=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.cy,2));a=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.y1-r.cy,2));v=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.y1-r.cy,2));y=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.cy,2));r.rx=r.ry=Math.max(l,a,v,y);break;case"closest-corner":l=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.cy,2));a=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.y1-r.cy,2));v=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.y1-r.cy,2));y=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.cy,2));r.rx=r.ry=Math.min(l,a,v,y);break;case"farthest-side":u[0]==="circle"?r.rx=r.ry=Math.max(r.cx,r.cy,r.x1-r.cx,r.y1-r.cy):(r.type=u[0],r.rx=Math.max(r.cx,r.x1-r.cx),r.ry=Math.max(r.cy,r.y1-r.cy));break;case"closest-side":case"contain":u[0]==="circle"?r.rx=r.ry=Math.min(r.cx,r.cy,r.x1-r.cx,r.y1-r.cy):(r.type=u[0],r.rx=Math.min(r.cx,r.x1-r.cx),r.ry=Math.min(r.cy,r.y1-r.cy))}if(u=o[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g),u)for(s=u.length,c=1/Math.max(s-1,1),f=0;f<s;f+=1)e=u[f].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),h=e[2]?parseFloat(e[2])/(e[3]==="%"?100:t.width):f*c,r.colorStops.push({color:e[1],stop:h})}return r};n.Gradient=function(n,i){var s,e,f,o;if(i.width!==0&&i.height!==0){if(s=t.createElement("canvas"),e=s.getContext("2d"),s.width=i.width,s.height=i.height,f=r.Generate.parseGradient(n,i),f)switch(f.type){case"linear":o=e.createLinearGradient(f.x0,f.y0,f.x1,f.y1);f.colorStops.forEach(u(o));e.fillStyle=o;e.fillRect(0,0,i.width,i.height);break;case"circle":o=e.createRadialGradient(f.cx,f.cy,0,f.cx,f.cy,f.rx);f.colorStops.forEach(u(o));e.fillStyle=o;e.fillRect(0,0,i.width,i.height);break;case"ellipse":var h=t.createElement("canvas"),c=h.getContext("2d"),a=Math.max(f.rx,f.ry),l=a*2;h.width=h.height=l;o=c.createRadialGradient(f.rx,f.ry,0,f.rx,f.ry,a);f.colorStops.forEach(u(o));c.fillStyle=o;c.fillRect(0,0,l,l);e.fillStyle=f.colorStops[f.colorStops.length-1].color;e.fillRect(0,0,s.width,s.height);e.drawImage(h,f.cx-f.rx,f.cy-f.ry,2*f.rx,2*f.ry)}return s}};n.ListAlpha=function(n){var t="",i;do i=n%26,t=String.fromCharCode(i+64)+t,n=n/26;while(n*26>26);return t};n.ListRoman=function(n){var i=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],r=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],u="",t,f=i.length;if(n<=0||n>=4e3)return n;for(t=0;t<f;t+=1)while(n>=r[t])n-=r[t],u+=i[t];return u}}();r.Parse=function(u,f){function dt(){return Math.max(Math.max(s.body.scrollWidth,s.documentElement.scrollWidth),Math.max(s.body.offsetWidth,s.documentElement.offsetWidth),Math.max(s.body.clientWidth,s.documentElement.clientWidth))}function gt(){return Math.max(Math.max(s.body.scrollHeight,s.documentElement.scrollHeight),Math.max(s.body.offsetHeight,s.documentElement.offsetHeight),Math.max(s.body.clientHeight,s.documentElement.clientHeight))}function p(n,t){var i=parseInt(e(n,t),10);return isNaN(i)?0:i}function d(n,t,i,r,u,f){f!=="transparent"&&(n.setVariable("fillStyle",f),n.fillRect(t,i,r,u),b+=1)}function ni(n,t,i){if(n.length>0)return t+i.toUpperCase()}function ti(n,t){switch(t){case"lowercase":return n.toLowerCase();case"capitalize":return n.replace(/(^|\s|:|-|\(|\))([a-z])/g,ni);case"uppercase":return n.toUpperCase();default:return n}}function ii(n){return/^(normal|none|0px)$/.test(n)}function et(n,t,i,r){n!==null&&o.trimText(n).length>0&&(r.fillText(n,t,i),b+=1)}function ot(n,t,i,r){var f=e(t,"fontWeight"),h=e(t,"fontFamily"),c=e(t,"fontSize"),u=o.parseTextShadows(e(t,"textShadow"));switch(parseInt(f,10)){case 401:f="bold";break;case 400:f="normal"}return n.setVariable("fillStyle",r),n.setVariable("font",[e(t,"fontStyle"),e(t,"fontVariant"),f,c,h].join(" ")),n.setVariable("textAlign","left"),u.length&&(n.setVariable("shadowColor",u[0].color),n.setVariable("shadowOffsetX",u[0].offsetX),n.setVariable("shadowOffsetY",u[0].offsetY),n.setVariable("shadowBlur",u[0].blur)),i!=="none"?o.Font(h,c,s):void 0}function ri(n,t,i,r,u){switch(t){case"underline":d(n,i.left,Math.round(i.top+r.baseline+r.lineWidth),i.width,1,u);break;case"overline":d(n,i.left,Math.round(i.top),i.width,1,u);break;case"line-through":d(n,i.left,Math.ceil(i.top+r.middle+r.lineWidth),i.width,1,u)}}function ui(n,t,i,r,u){var f,e;return kt.rangeBounds&&!u?((i!=="none"||o.trimText(t).length!==0)&&(f=fi(t,n.node,n.textOffset)),n.textOffset+=t.length):n.node&&typeof n.node.nodeValue=="string"&&(e=r?n.node.splitText(t.length):null,f=ei(n.node,u),n.node=e),f}function fi(n,t,i){var r=s.createRange();return r.setStart(t,i),r.setEnd(t,i+n.length),r.getBoundingClientRect()}function ei(n,t){var r=n.parentNode,i=s.createElement("wrapper"),f=n.cloneNode(!0),u;return i.appendChild(n.cloneNode(!0)),r.replaceChild(i,n),u=t?o.OffsetBounds(i):o.Bounds(i),r.replaceChild(f,i),u}function st(n,t,i){var u=i.ctx,c=e(n,"color"),s=e(n,"textDecoration"),h=e(n,"textAlign"),l,r,a={node:t,textOffset:0};o.trimText(t.nodeValue).length>0&&(t.nodeValue=ti(t.nodeValue,e(n,"textTransform")),h=h.replace(["-webkit-auto"],["auto"]),r=!f.letterRendering&&/^(left|right|justify|auto)$/.test(h)&&ii(e(n,"letterSpacing"))?t.nodeValue.split(/(\b| )/):t.nodeValue.split(""),l=ot(u,n,s,c),f.chinese&&r.forEach(function(n,t){/.*[\u4E00-\u9FA5].*$/.test(n)&&(n=n.split(""),n.unshift(t,1),r.splice.apply(r,n))}),r.forEach(function(n,t){var f=ui(a,n,s,t<r.length-1,i.transform.matrix);f&&(et(n,f.left,f.bottom,u),ri(u,s,f,l,c))}))}function oi(n,t){var i=s.createElement("boundelement"),r,u;return i.style.display="inline",r=n.style.listStyleType,n.style.listStyleType="none",i.appendChild(s.createTextNode(t)),n.insertBefore(i,n.firstChild),u=o.Bounds(i),n.removeChild(i),n.style.listStyleType=r,u}function si(n){var t=-1,i=1,r=n.parentNode.childNodes;if(n.parentNode){while(r[++t]!==n)r[t].nodeType===1&&i++;return i}return-1}function hi(n,t){var i=si(n),u;switch(t){case"decimal":u=i;break;case"decimal-leading-zero":u=i.toString().length===1?i="0"+i.toString():i.toString();break;case"upper-roman":u=r.Generate.ListRoman(i);break;case"lower-roman":u=r.Generate.ListRoman(i).toLowerCase();break;case"lower-alpha":u=r.Generate.ListAlpha(i).toLowerCase();break;case"upper-alpha":u=r.Generate.ListAlpha(i)}return u+". "}function ci(n,t,i){var f,r,u=t.ctx,o=e(n,"listStyleType"),s;if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(o)){if(r=hi(n,o),s=oi(n,r),ot(u,n,"none",e(n,"color")),e(n,"listStylePosition")==="inside")u.setVariable("textAlign","left"),f=i.left;else return;et(r,f,s.bottom,u)}}function ht(n){var t=u[n];return t&&t.succeeded===!0?t.img:!1}function ct(n,t){var i=Math.max(n.left,t.left),r=Math.max(n.top,t.top),u=Math.min(n.left+n.width,t.left+t.width),f=Math.min(n.top+n.height,t.top+t.height);return{left:i,top:r,width:u-i,height:f-r}}function li(n,t,i){var r,u=t.cssPosition!=="static",f=u?e(n,"zIndex"):"auto",o=e(n,"opacity"),s=e(n,"cssFloat")!=="none";t.zIndex=r=l(f);r.isPositioned=u;r.isFloated=s;r.opacity=o;r.ownStacking=f!=="auto"||o<1;i&&i.zIndex.children.push(t)}function lt(n,t,i,r,u){var f=p(t,"paddingLeft"),e=p(t,"paddingTop"),o=p(t,"paddingRight"),s=p(t,"paddingBottom");at(n,i,0,0,i.width,i.height,r.left+f+u[3].width,r.top+e+u[0].width,r.width-(u[1].width+u[3].width+f+o),r.height-(u[0].width+u[2].width+e+s))}function ai(n){return["Top","Right","Bottom","Left"].map(function(t){return{width:p(n,"border"+t+"Width"),color:e(n,"border"+t+"Color")}})}function vi(n){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(t){return e(n,"border"+t+"Radius")})}function y(n,t,i,r){var u=function(n,t,i){return{x:n.x+(t.x-n.x)*i,y:n.y+(t.y-n.y)*i}};return{start:n,startControl:t,endControl:i,end:r,subdivide:function(f){var e=u(n,t,f),o=u(t,i,f),s=u(i,r,f),h=u(e,o,f),c=u(o,s,f),l=u(h,c,f);return[y(n,e,h,l),y(l,c,s,r)]},curveTo:function(n){n.push(["bezierCurve",t.x,t.y,i.x,i.y,r.x,r.y])},curveToReversed:function(r){r.push(["bezierCurve",i.x,i.y,t.x,t.y,n.x,n.y])}}}function v(n,t,i,r,u,f,e){t[0]>0||t[1]>0?(n.push(["line",r[0].start.x,r[0].start.y]),r[0].curveTo(n),r[1].curveTo(n)):n.push(["line",f,e]);(i[0]>0||i[1]>0)&&n.push(["line",u[0].start.x,u[0].start.y])}function g(n,t,i,r,u,f,e){var o=[];return t[0]>0||t[1]>0?(o.push(["line",r[1].start.x,r[1].start.y]),r[1].curveTo(o)):o.push(["line",n.c1[0],n.c1[1]]),i[0]>0||i[1]>0?(o.push(["line",f[0].start.x,f[0].start.y]),f[0].curveTo(o),o.push(["line",e[0].end.x,e[0].end.y]),e[0].curveToReversed(o)):(o.push(["line",n.c2[0],n.c2[1]]),o.push(["line",n.c3[0],n.c3[1]])),t[0]>0||t[1]>0?(o.push(["line",u[1].end.x,u[1].end.y]),u[1].curveToReversed(o)):o.push(["line",n.c4[0],n.c4[1]]),o}function yi(n,t,i){var r=n.left,u=n.top,f=n.width,e=n.height,v=t[0][0],y=t[0][1],o=t[1][0],p=t[1][1],s=t[2][0],c=t[2][1],w=t[3][0],l=t[3][1],a=f-o,b=e-c,k=f-s,d=e-l;return{topLeftOuter:h(r,u,v,y).topLeft.subdivide(.5),topLeftInner:h(r+i[3].width,u+i[0].width,Math.max(0,v-i[3].width),Math.max(0,y-i[0].width)).topLeft.subdivide(.5),topRightOuter:h(r+a,u,o,p).topRight.subdivide(.5),topRightInner:h(r+Math.min(a,f+i[3].width),u+i[0].width,a>f+i[3].width?0:o-i[3].width,p-i[0].width).topRight.subdivide(.5),bottomRightOuter:h(r+k,u+b,s,c).bottomRight.subdivide(.5),bottomRightInner:h(r+Math.min(k,f+i[3].width),u+Math.min(b,e+i[0].width),Math.max(0,s-i[1].width),Math.max(0,c-i[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:h(r,u+d,w,l).bottomLeft.subdivide(.5),bottomLeftInner:h(r+i[3].width,u+d,Math.max(0,w-i[3].width),Math.max(0,l-i[2].width)).bottomLeft.subdivide(.5)}}function pi(n,t,i,r,u){var o=e(n,"backgroundClip"),f=[];switch(o){case"content-box":case"padding-box":v(f,r[0],r[1],t.topLeftInner,t.topRightInner,u.left+i[3].width,u.top+i[0].width);v(f,r[1],r[2],t.topRightInner,t.bottomRightInner,u.left+u.width-i[1].width,u.top+i[0].width);v(f,r[2],r[3],t.bottomRightInner,t.bottomLeftInner,u.left+u.width-i[1].width,u.top+u.height-i[2].width);v(f,r[3],r[0],t.bottomLeftInner,t.topLeftInner,u.left+i[3].width,u.top+u.height-i[2].width);break;default:v(f,r[0],r[1],t.topLeftOuter,t.topRightOuter,u.left,u.top);v(f,r[1],r[2],t.topRightOuter,t.bottomRightOuter,u.left+u.width,u.top);v(f,r[2],r[3],t.bottomRightOuter,t.bottomLeftOuter,u.left+u.width,u.top+u.height);v(f,r[3],r[0],t.bottomLeftOuter,t.topLeftOuter,u.left,u.top+u.height)}return f}function wi(n,t,i){for(var l=t.left,p=t.top,a=t.width,v=t.height,u,r,e,o,c,s=vi(n),f=yi(t,s,i),y={clip:pi(n,f,i,s,t),borders:[]},h=0;h<4;h++)if(i[h].width>0){u=l;r=p;e=a;o=v-i[2].width;switch(h){case 0:o=i[0].width;c=g({c1:[u,r],c2:[u+e,r],c3:[u+e-i[1].width,r+o],c4:[u+i[3].width,r+o]},s[0],s[1],f.topLeftOuter,f.topLeftInner,f.topRightOuter,f.topRightInner);break;case 1:u=l+a-i[1].width;e=i[1].width;c=g({c1:[u+e,r],c2:[u+e,r+o+i[2].width],c3:[u,r+o],c4:[u,r+i[0].width]},s[1],s[2],f.topRightOuter,f.topRightInner,f.bottomRightOuter,f.bottomRightInner);break;case 2:r=r+v-i[2].width;o=i[2].width;c=g({c1:[u+e,r+o],c2:[u,r+o],c3:[u+i[3].width,r],c4:[u+e-i[3].width,r]},s[2],s[3],f.bottomRightOuter,f.bottomRightInner,f.bottomLeftOuter,f.bottomLeftInner);break;case 3:e=i[3].width;c=g({c1:[u,r+o+i[2].width],c2:[u,r],c3:[u+e,r+i[0].width],c4:[u+e,r+o]},s[3],s[0],f.bottomLeftOuter,f.bottomLeftInner,f.topLeftOuter,f.topLeftInner)}y.borders.push({args:c,color:i[h].color})}return y}function tt(n,t){var i=n.drawShape();return t.forEach(function(n,t){i[t===0?"moveTo":n[0]+"To"].apply(null,n.slice(1))}),i}function bi(n,t,i){i!=="transparent"&&(n.setVariable("fillStyle",i),tt(n,t),n.fill(),b+=1)}function it(n,t,i){var r=s.createElement("valuewrap"),u,f;["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"].forEach(function(t){try{r.style[t]=e(n,t)}catch(i){o.log("html2canvas: Parse: Exception caught in renderFormValue: "+i.message)}});r.style.borderColor="black";r.style.borderStyle="solid";r.style.display="block";r.style.position="absolute";(/^(submit|reset|button|text|password)$/.test(n.type)||n.nodeName==="SELECT")&&(r.style.lineHeight=e(n,"height"));r.style.top=t.top+"px";r.style.left=t.left+"px";u=n.nodeName==="SELECT"?(n.options[n.selectedIndex]||0).text:n.value;u||(u=n.placeholder);f=s.createTextNode(u);r.appendChild(f);k.appendChild(r);st(n,f,i);k.removeChild(r)}function at(n){n.drawImage.apply(n,Array.prototype.slice.call(arguments,1));b+=1}function vt(i,r){var f=n.getComputedStyle(i,r),u,s,h,e;if(f&&f.content&&f.content!=="none"&&f.content!=="-moz-alt-content"&&f.display!=="none")return u=f.content+"",s=u.substr(0,1),s===u.substr(u.length-1)&&s.match(/'|"/)&&(u=u.substr(1,u.length-2)),h=u.substr(0,3)==="url",e=t.createElement(h?"img":"span"),e.className=a+"-before "+a+"-after",Object.keys(f).filter(ki).forEach(function(n){try{e.style[n]=f[n]}catch(t){o.log(["Tried to assign readonly property ",n,"Error:",t])}}),h?e.src=o.parseBackgroundImage(u)[0].args[0]:e.innerHTML=u,e}function ki(t){return isNaN(n.parseInt(t,10))}function di(n,t){var i=vt(n,":before"),r=vt(n,":after");(i||r)&&(i&&(n.className+=" "+a+"-before",n.parentNode.insertBefore(i,n),ut(i,t,!0),n.parentNode.removeChild(i),n.className=n.className.replace(a+"-before","").trim()),r&&(n.className+=" "+a+"-after",n.appendChild(r),ut(r,t,!0),n.removeChild(r),n.className=n.className.replace(a+"-after","").trim()))}function yt(n,t,i,r){var u=Math.round(r.left+i.left),f=Math.round(r.top+i.top);n.createPattern(t);n.translate(u,f);n.fill();n.translate(-u,-f)}function rt(n,t,i,r,u,f,e,o){var s=[];s.push(["line",Math.round(u),Math.round(f)]);s.push(["line",Math.round(u+e),Math.round(f)]);s.push(["line",Math.round(u+e),Math.round(o+f)]);s.push(["line",Math.round(u),Math.round(o+f)]);tt(n,s);n.save();n.clip();yt(n,t,i,r);n.restore()}function gi(n,t,i){d(n,t.left,t.top,t.width,t.height,i)}function nr(n,t,i,r,u){var h=o.BackgroundSize(n,t,r,u),f=o.BackgroundPosition(n,t,r,u,h),s=e(n,"backgroundRepeat").split(",").map(o.trimText);r=ir(r,h);s=s[u]||s[0];switch(s){case"repeat-x":rt(i,r,f,t,t.left,t.top+f.top,99999,r.height);break;case"repeat-y":rt(i,r,f,t,t.left+f.left,t.top,r.width,99999);break;case"no-repeat":rt(i,r,f,t,t.left+f.left,t.top+f.top,r.width,r.height);break;default:yt(i,r,f,{top:t.top,left:t.left,width:r.width,height:r.height})}}function tr(n,t,i){for(var r=e(n,"backgroundImage"),s=o.parseBackgroundImage(r),u,f=s.length,h;f--;)(r=s[f],r.args&&r.args.length!==0)&&(h=r.method==="url"?r.args[0]:r.value,u=ht(h),u?nr(n,t,i,u,f):o.log("html2canvas: Error loading background:",r))}function ir(n,t){if(n.width===t.width&&n.height===t.height)return n;var r,i=s.createElement("canvas");return i.width=t.width,i.height=t.height,r=i.getContext("2d"),at(r,n,0,0,n.width,n.height,0,0,t.width,t.height),i}function rr(n,t,i){return n.setVariable("globalAlpha",e(t,"opacity")*(i?i.opacity:1))}function ur(n){return n.replace("px","")}function fr(n){var i=e(n,"transform")||e(n,"-webkit-transform")||e(n,"-moz-transform")||e(n,"-ms-transform")||e(n,"-o-transform"),r=e(n,"transform-origin")||e(n,"-webkit-transform-origin")||e(n,"-moz-transform-origin")||e(n,"-ms-transform-origin")||e(n,"-o-transform-origin")||"0px 0px",u,t;if(r=r.split(" ").map(ur).map(o.asFloat),i&&i!=="none"&&(t=i.match(pt),t))switch(t[1]){case"matrix":u=t[2].split(",").map(o.trimText).map(o.asFloat)}return{origin:r,matrix:u}}function er(n,t,i,r){var s=c(t?i.width:dt(),t?i.height:gt()),u={ctx:s,opacity:rr(s,n,t),cssPosition:e(n,"position"),borders:ai(n),transform:r,clip:t&&t.clip?o.Extend({},t.clip):null};return li(n,u,t),f.useOverflow===!0&&/(hidden|scroll|auto)/.test(e(n,"overflow"))===!0&&/(BODY)/i.test(n.nodeName)===!1&&(u.clip=u.clip?ct(u.clip,i):i),u}function or(n,t,i){var r={left:t.left+n[3].width,top:t.top+n[0].width,width:t.width-(n[1].width+n[3].width),height:t.height-(n[0].width+n[2].width)};return i&&(r=ct(r,i)),r}function sr(n,t){var i=t.matrix?o.OffsetBounds(n):o.Bounds(n);return t.origin[0]+=i.left,t.origin[1]+=i.top,i}function wt(n,t,i,r){var l=fr(n,t),f=sr(n,l),a,u=er(n,t,f,l),h=u.borders,s=u.ctx,c=or(h,f,u.clip),v=wi(n,f,h),y=ft.test(n.nodeName)?"#efefef":e(n,"backgroundColor");tt(s,v.clip);s.save();s.clip();c.height>0&&c.width>0&&!r?(gi(s,f,y),tr(n,c,s)):r&&(u.backgroundColor=y);s.restore();v.borders.forEach(function(n){bi(s,n.args,n.color)});i||di(n,u);switch(n.nodeName){case"IMG":(a=ht(n.getAttribute("src")))?lt(s,n,a,f,h):o.log("html2canvas: Error loading <img>:"+n.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(n.type)&&(n.value||n.placeholder||"").length>0&&it(n,f,u);break;case"TEXTAREA":(n.value||n.placeholder||"").length>0&&it(n,f,u);break;case"SELECT":(n.options||n.placeholder||"").length>0&&it(n,f,u);break;case"LI":ci(n,u,c);break;case"CANVAS":lt(s,n,n,f,h)}return u}function hr(n){return e(n,"display")!=="none"&&e(n,"visibility")!=="hidden"&&!n.hasAttribute("data-html2canvas-ignore")}function ut(n,t,i){hr(n)&&(t=wt(n,t,i,!1)||t,ft.test(n.nodeName)||bt(n,t,i))}function bt(n,t,i){o.Children(n).forEach(function(r){r.nodeType===r.ELEMENT_NODE?ut(r,t,i):r.nodeType===r.TEXT_NODE&&st(n,r,t)})}function cr(){var n=e(t.documentElement,"backgroundColor"),r=o.isTransparent(n)&&w===t.body,i=wt(w,null,!1,r);return bt(w,i),r&&(n=i.backgroundColor),k.removeChild(nt),{backgroundColor:n,stack:i}}var h,pt;n.scroll(0,0);var w=f.elements===i?t.body:f.elements[0],b=0,s=w.ownerDocument,o=r.Util,kt=o.Support(f,s),ft=new RegExp("("+f.ignoreElements+")"),k=s.body,e=o.getCSS,a="___html2canvas___pseudoelement",nt=s.createElement("style");return nt.innerHTML="."+a+'-before:before { content: "" !important; display: none !important; }.'+a+'-after:after { content: "" !important; display: none !important; }',k.appendChild(nt),u=u||{},h=function(n){return function(t,i,r,u){var o=r*n,s=u*n,f=t+r,e=i+u;return{topLeft:y({x:t,y:e},{x:t,y:e-s},{x:f-o,y:i},{x:f,y:i}),topRight:y({x:t,y:i},{x:t+o,y:i},{x:f,y:e-s},{x:f,y:e}),bottomRight:y({x:f,y:i},{x:f,y:i+s},{x:t+o,y:e},{x:t,y:e}),bottomLeft:y({x:f,y:e},{x:f-o,y:e},{x:t,y:i+s},{x:t,y:i})}}}(4*((Math.sqrt(2)-1)/3)),pt=/(matrix)\((.+)\)/,cr()};r.Preload=function(u){function rt(n){o.href=n;o.href=o.href;var t=o.protocol+o.host;return t===p}function h(){e.log("html2canvas: start: images: "+f.numLoaded+" / "+f.numTotal+" (failed: "+f.numFailed+")");!f.firstRun&&f.numLoaded>=f.numTotal&&(e.log("Finished loading images: # "+f.numTotal+" (failed: "+f.numFailed+")"),typeof u.complete=="function"&&u.complete(f))}function k(t,r,e){var c,a=u.proxy,s;o.href=t;t=o.href;c="html2canvas_"+nt++;e.callbackname=c;a+=a.indexOf("?")>-1?"&":"?";a+="url="+encodeURIComponent(t)+"&callback="+c;s=w.createElement("script");n[c]=function(t){t.substring(0,6)==="error:"?(e.succeeded=!1,f.numLoaded++,f.numFailed++,h()):(l(r,e),r.src=t);n[c]=i;try{delete n[c]}catch(u){}s.parentNode.removeChild(s);s=null;delete e.script;delete e.callbackname};s.setAttribute("type","text/javascript");s.setAttribute("src",a);e.script=s;n.document.body.appendChild(s)}function d(t,i){var u=n.getComputedStyle(t,i),f=u.content;f.substr(0,3)==="url"&&s.loadImage(r.Util.parseBackgroundImage(f)[0].args[0]);y(u.backgroundImage,t)}function ut(n){d(n,":before");d(n,":after")}function ft(n,t){var u=r.Generate.Gradient(n,t);u!==i&&(f[n]={img:u,succeeded:!0},f.numTotal++,f.numLoaded++,h())}function et(n){return n&&n.method&&n.args&&n.args.length>0}function y(n,t){var u;r.Util.parseBackgroundImage(n).filter(et).forEach(function(n){n.method==="url"?s.loadImage(n.args[0]):n.method.match(/\-?gradient$/)&&(u===i&&(u=r.Util.Bounds(t)),ft(n.value,u))})}function g(n){var t=!1;try{e.Children(n).forEach(g)}catch(r){}try{t=n.nodeType}catch(u){t=!1;e.log("html2canvas: failed to access some element's nodeType - Exception: "+u.message)}if(t===1||t===i){ut(n);try{y(e.getCSS(n,"backgroundImage"),n)}catch(r){e.log("html2canvas: failed to get background-image - Exception: "+r.message)}y(n)}}function l(t,r){t.onload=function(){r.timer!==i&&n.clearTimeout(r.timer);f.numLoaded++;r.succeeded=!0;t.onerror=t.onload=null;h()};t.onerror=function(){if(t.crossOrigin==="anonymous"&&(n.clearTimeout(r.timer),u.proxy)){var i=t.src;t=new Image;r.img=t;t.src=i;k(t.src,t,r);return}f.numLoaded++;f.numFailed++;r.succeeded=!1;t.onerror=t.onload=null;h()}}var f={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},p,e=r.Util,s,c,nt=0,a=u.elements[0]||t.body,w=a.ownerDocument,b=a.getElementsByTagName("img"),tt=b.length,o=w.createElement("a"),it=function(n){return n.crossOrigin!==i}(new Image),v;for(o.href=n.location.href,p=o.protocol+o.host,s={loadImage:function(n){var t,r;n&&f[n]===i&&(t=new Image,n.match(/data:image\/.*;base64,/i)?(t.src=n.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),r=f[n]={img:t},f.numTotal++,l(t,r)):rt(n)||u.allowTaint===!0?(r=f[n]={img:t},f.numTotal++,l(t,r),t.src=n):it&&!u.allowTaint&&u.useCORS?(t.crossOrigin="anonymous",r=f[n]={img:t},f.numTotal++,l(t,r),t.src=n):u.proxy&&(r=f[n]={img:t},f.numTotal++,k(n,t,r)))},cleanupDOM:function(r){var o,s;if(!f.cleanupDone){r&&typeof r=="string"?e.log("html2canvas: Cleanup because: "+r):e.log("html2canvas: Cleanup after timeout: "+u.timeout+" ms.");for(s in f)if(f.hasOwnProperty(s)&&(o=f[s],typeof o=="object"&&o.callbackname&&o.succeeded===i)){n[o.callbackname]=i;try{delete n[o.callbackname]}catch(c){}o.script&&o.script.parentNode&&(o.script.setAttribute("src","about:blank"),o.script.parentNode.removeChild(o.script));f.numLoaded++;f.numFailed++;e.log("html2canvas: Cleaned up failed img: '"+s+"' Steps: "+f.numLoaded+" / "+f.numTotal)}n.stop!==i?n.stop():t.execCommand!==i&&t.execCommand("Stop",!1);t.close!==i&&t.close();f.cleanupDone=!0;r&&typeof r=="string"||h()}},renderingDone:function(){v&&n.clearTimeout(v)}},u.timeout>0&&(v=n.setTimeout(s.cleanupDOM,u.timeout)),e.log("html2canvas: Preload starts: finding background-images"),f.firstRun=!0,g(a),e.log("html2canvas: Preload: Finding images"),c=0;c<tt;c+=1)s.loadImage(b[c].getAttribute("src"));return f.firstRun=!1,e.log("html2canvas: Preload: Done."),f.numTotal===f.numLoaded&&h(),s};r.Renderer=function(n,u){function f(n){function u(n){Object.keys(n).sort().forEach(function(i){var r=[],f=[],e=[],o=[];n[i].forEach(function(n){n.node.zIndex.isPositioned||n.node.zIndex.opacity<1?e.push(n):n.node.zIndex.isFloated?f.push(n):r.push(n)}),function s(n){n.forEach(function(n){o.push(n);n.children&&s(n.children)})}(r.concat(f,e));o.forEach(function(n){n.context?u(n.context):t.push(n.node)})})}var t=[],r;return r=function(n){function r(n,t,u){var f=t.zIndex.zindex==="auto"?0:Number(t.zIndex.zindex),s=n,h=t.zIndex.isPositioned,c=t.zIndex.isFloated,e={node:t},o=u;t.zIndex.ownStacking?(s=e.context={"!":[{node:t,children:[]}]},o=i):(h||c)&&(o=e.children=[]);f===0&&u?u.push(e):(n[f]||(n[f]=[]),n[f].push(e));t.zIndex.children.forEach(function(n){r(s,n,o)})}var t={};return r(t,n),t}(n),u(r),t}function e(n){var t;if(typeof u.renderer=="string"&&r.Renderer[n]!==i)t=r.Renderer[n](u);else if(typeof n=="function")t=n(u);else throw new Error("Unknown renderer");if(typeof t!="function")throw new Error("Invalid renderer defined");return t}return e(u.renderer)(n,u,t,f(n.stack),r)};r.Util.Support=function(n,t){function u(){var u=new Image,n=t.createElement("canvas"),f=n.getContext===i?!1:n.getContext("2d");if(f===!1)return!1;n.width=n.height=10;u.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'><foreignObject width='10' height='10'><div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>sup<\/div><\/foreignObject><\/svg>";try{f.drawImage(u,0,0);n.toDataURL()}catch(e){return!1}return r.Util.log("html2canvas: Parse: SVG powered rendering available"),!0}function f(){var i,n,r,u,f=!1;return t.createRange&&(i=t.createRange(),i.getBoundingClientRect&&(n=t.createElement("boundtest"),n.style.height="123px",n.style.display="block",t.body.appendChild(n),i.selectNode(n),r=i.getBoundingClientRect(),u=r.height,u===123&&(f=!0),t.body.removeChild(n))),f}return{rangeBounds:f(),svgRendering:n.svgRendering&&u()}};n.html2canvas=function(t,i){t=t.length?t:[t];var f,e,u={logging:!1,elements:t,background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas"};return u=r.Util.Extend(i,u),r.logging=u.logging,u.complete=function(n){if((typeof u.onpreloaded!="function"||u.onpreloaded(n)!==!1)&&(f=r.Parse(n,u),typeof u.onparsed!="function"||u.onparsed(f)!==!1)&&(e=r.Renderer(f,u),typeof u.onrendered=="function"))u.onrendered(e)},n.setTimeout(function(){r.Preload(u)},0),{render:function(n,t){return r.Renderer(n,r.Util.Extend(t,u))},parse:function(n,t){return r.Parse(n,r.Util.Extend(t,u))},preload:function(n){return r.Preload(r.Util.Extend(n,u))},log:r.Util.log}};n.html2canvas.log=r.Util.log;n.html2canvas.Renderer={Canvas:i};r.Renderer.Canvas=function(n){function c(n,t){n.beginPath();t.forEach(function(t){n[t.name].apply(n,t.arguments)});n.closePath()}function l(n){if(h.indexOf(n.arguments[0].src)===-1){e.drawImage(n.arguments[0],0,0);try{e.getImageData(0,0,1,1)}catch(t){return f=s.createElement("canvas"),e=f.getContext("2d"),!1}h.push(n.arguments[0].src)}return!0}function a(t,i){switch(i.type){case"variable":t[i.name]=i.arguments;break;case"function":switch(i.name){case"createPattern":if(i.arguments[0].width>0&&i.arguments[0].height>0)try{t.fillStyle=t.createPattern(i.arguments[0],"repeat")}catch(r){o.log("html2canvas: Renderer: Error creating pattern",r.message)}break;case"drawShape":c(t,i.arguments);break;case"drawImage":i.arguments[8]>0&&i.arguments[7]>0&&(!n.taintTest||n.taintTest&&l(i))&&t.drawImage.apply(t,i.arguments);break;default:t[i.name].apply(t,i.arguments)}}}n=n||{};var s=t,h=[],f=t.createElement("canvas"),e=f.getContext("2d"),o=r.Util,u=n.canvas||s.createElement("canvas");return function(n,t,r,f,e){var s=u.getContext("2d"),c,h,v,l=n.stack;return(u.width=u.style.width=t.width||l.ctx.width,u.height=u.style.height=t.height||l.ctx.height,v=s.fillStyle,s.fillStyle=o.isTransparent(l.backgroundColor)&&t.background!==i?t.background:n.backgroundColor,s.fillRect(0,0,u.width,u.height),s.fillStyle=v,f.forEach(function(n){s.textBaseline="bottom";s.save();n.transform.matrix&&(s.translate(n.transform.origin[0],n.transform.origin[1]),s.transform.apply(s,n.transform.matrix),s.translate(-n.transform.origin[0],-n.transform.origin[1]));n.clip&&(s.beginPath(),s.rect(n.clip.left,n.clip.top,n.clip.width,n.clip.height),s.clip());n.ctx.storage&&n.ctx.storage.forEach(function(n){a(s,n)});s.restore()}),o.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),t.elements.length===1&&typeof t.elements[0]=="object"&&t.elements[0].nodeName!=="BODY")?(h=e.Util.Bounds(t.elements[0]),c=r.createElement("canvas"),c.width=Math.ceil(h.width),c.height=Math.ceil(h.height),s=c.getContext("2d"),s.drawImage(u,h.left,h.top,h.width,h.height,0,0,h.width,h.height),u=null,c):u}}}(window,document);define("home:static/js/survey/widget/question_handle.js",function(n,t){"use strict";var i='<div class=question-handle-dialog> <div class=handle-dialog> <div class=handle-dialog-title>题目设置<span class=close>&times;<\/span><\/div> <div class=handle-dialog-content><\/div> <div class=handle-dialog-button> <input type=button class="dialog-button-survey button-confirm" id=survey-confirm-y value="确定">&nbsp; <input type=button class="dialog-button-survey button-cancel" id=survey-confirm-n value="取消"> <\/div> <\/div> <div class=survey-mask><\/div><\/div>';$("body").append("<style>.handle-dialog{font-size:14px;font-family:微软雅黑;position:fixed;left:50%;top:10%;width:500px;min-height:220px;margin-left:-250px;background:#fff;border-radius:4px;border:1px solid #f6f9fe;z-index:1003;padding-bottom:30px}.handle-dialog-title{height:40px;line-height:40px;padding-left:16px;color:#2c4a93;background:#f1f5fd;border-bottom:1px solid #b0c0e7}.handle-dialog-content{margin:15px;color:#666;min-height: 80px;}.handle-dialog-button{text-align:center;height:20px;line-height:20px;padding-top:0px}.survey-mask{position:fixed;height:100%;width:100%;background:#aaa;z-index:1002;top:0;left:0;opacity:.5;filter:alpha(opacity:50)}.button{width:64px;height:30px;line-height:20px;border-radius:3px;background:#f1f5fd;border:1px solid #b0c0e7;color:#2c4a93;cursor:pointer}.button:hover{background:#f1f5fd;border:1px solid #6583cc;color:#2c4a93}.button-confirm{background:#249cfa;border:1px solid #249cfa;color:#fff}.button-confirm:hover{background:#48aefe;border:1px solid #48aefe;color:#fff}.close{font-size:18px;line-height:40px!important;font-weight:700;color:#666;float:right;padding-right:16px;cursor:pointer}<\/style>");t.show=function(n,t,r,u,f){function p(n,t){var r;if(document.selection)r=document.selection.createRange(),r.text=t;else if("number"==typeof n.selectionStart&&"number"==typeof n.selectionEnd){var u=n.selectionStart,e=n.selectionEnd,f=u,i=n.value;n.value=i.substring(0,u)+t+i.substring(e,i.length);f+=t.length;n.selectionStart=n.selectionEnd=f}else n.value+=t}function w(n){if(n){var t=n.split(",");o.find(".exclusive-choice-select").val(t[0]);t.length>1&&(t.splice(0,1),$.each(t,function(n,t){y(t)}))}}function y(t){e='<li><label>选项<select class="exclusive-choice-select" style="height: 30px;line-height: 30px;font-size: 12px;margin: 0 5px;"><option class="exclusive-option" value="0">请选择选项<\/option>';$(n).parents(".topic-type-content").find(".choice").length>0&&$(n).parents(".topic-type-content").find(".choice").each(function(){var n=$(this).find(".edit-area").html(),t=n.length>15?n.substring(0,15)+"...":n;e+='<option class="exclusive-choice-option" value="'+$(this).attr("choice_absolute_id")+'">'+t+"<\/option>"});e+='<\/select>与其他选项互斥<span class="exclusive-delete-button"><\/span><\/label><\/li>';o.find(".exclusive-choice-select").last().parent().parent().after(e);t&&o.find(".exclusive-choice-select").last().val(t)}var a=$.Deferred(),o,e,s,h,c,l,v;$("body").append(i);o=$(".question-handle-dialog");e='<ul class="handle-area" question-order="'+r+'">';switch(t){case"6":e+='<li><label><input type="checkbox" name="type-change" class="type-change" question-type="'+t+'"/>  变为多选题<\/label><\/li>';e+='<li><label><input type="checkbox" name="question-required" class="question-required no-required"/>  该题可跳过不答<\/label><\/li>';e+='<li style="margin-top: 20px"><label>选项引用 <select class="choice-quote-select" style="height: 30px;line-height: 30px;font-size: 12px;margin: 0 5px;"><option class="choice-quote-option" value="0">请选择来源题目<\/option>';$(n).parents(".topic-type-content").prevAll(".topic-type-content").length>0&&$(n).parents(".topic-type-content").prevAll(".topic-type-content").each(function(){if("8"===$(this).find(".question-title").attr("type")&&"Y"===$(this).find(".question-id").attr("question-required")){var n=$(this).find(".qs-content").html().length>15?$(this).find(".qs-content").html().substring(0,15)+"...":$(this).find(".qs-content").html();e+='<option class="choice-quote-option" value="'+$(this).find(".question-id").attr("absolute_id")+'">'+$(this).find(".question-id").html()+" "+n+"<\/option>"}});e+="<\/select>  的答案<\/label><\/li>";break;case"14":e+='<li><label><input type="checkbox" name="type-change" class="type-change" question-type="'+t+'"/>  变为图片多选题<\/label><\/li>';e+='<li><label><input type="checkbox" name="question-required" class="question-required no-required"/>  该题可跳过不答<\/label><\/li>';break;case"8":e+='<li><label><input type="checkbox" name="type-change" class="type-change" question-type="'+t+'"/>  变为单选题<\/label><\/li>';e+='<li><label><input type="checkbox" name="question-required" class="question-required no-required"/>  该题可跳过不答<\/label><\/li>';e+='<li style="margin-top: 15px"><label>最少选<input type="text" name="min-checkbox" class="min-checkbox">项&nbsp;&nbsp;最多选<input type="text" name="max-checkbox" class="max-checkbox">项<label><\/li>';e+='<li style="margin-top: 15px"><label>选项互斥：选中某个选项，则其他选择均取消。<label><\/li>';e+='<li><label>选项<select class="exclusive-choice-select" style="height: 30px;line-height: 30px;font-size: 12px;margin: 0 5px;"><option class="exclusive-option" value="0">请选择选项<\/option>';$(n).parents(".topic-type-content").find(".choice").length>0&&$(n).parents(".topic-type-content").find(".choice").each(function(){var n=$(this).find(".edit-area").html(),t=n.length>15?n.substring(0,15)+"...":n;e+='<option class="exclusive-choice-option" value="'+$(this).attr("choice_absolute_id")+'">'+t+"<\/option>"});e+='<\/select>与其他选项互斥<span class="exclusive-add-button"><\/span><\/label><\/li>';e+='<li style="margin-top: 20px"><label>选项引用 <select class="choice-quote-select" style="height: 30px;line-height: 30px;font-size: 12px;margin: 0 5px;"><option class="choice-quote-option" value="0">请选择来源题目<\/option>';$(n).parents(".topic-type-content").prevAll(".topic-type-content").length>0&&$(n).parents(".topic-type-content").prevAll(".topic-type-content").each(function(){if("8"===$(this).find(".question-title").attr("type")&&"Y"===$(this).find(".question-id").attr("question-required")){var n=$(this).find(".qs-content").html().length>15?$(this).find(".qs-content").html().substring(0,15)+"...":$(this).find(".qs-content").html();e+='<option class="choice-quote-option" value="'+$(this).find(".question-id").attr("absolute_id")+'">'+$(this).find(".question-id").html()+" "+n+"<\/option>"}});e+="<\/select>  的答案<\/label><\/li>";break;case"15":e+='<li><label><input type="checkbox" name="type-change" class="type-change" question-type="'+t+'"/>  变为图片单选题<\/label><\/li>';e+='<li><label><input type="checkbox" name="question-required" class="question-required no-required"/>  该题可跳过不答<\/label><\/li>';e+='<li style="margin-top: 15px"><label>最少选<input type="text" name="min-checkbox" class="min-checkbox">项&nbsp;&nbsp;最多选<input type="text" name="max-checkbox" class="max-checkbox">项<label><\/li>';break;case"7":e+='<li><label><input type="checkbox" name="question-required" class="question-required no-required"/>  该题可跳过不答<\/label><\/li>';e+='<li style="margin-top: 20px"><label>选项引用 <select class="choice-quote-select" style="height: 30px;line-height: 30px;font-size: 12px;margin: 0 5px;"><option class="choice-quote-option" value="0">请选择来源题目<\/option>';$(n).parents(".topic-type-content").prevAll(".topic-type-content").length>0&&$(n).parents(".topic-type-content").prevAll(".topic-type-content").each(function(){if("8"===$(this).find(".question-title").attr("type")&&"Y"===$(this).find(".question-id").attr("question-required")){var n=$(this).find(".qs-content").html().length>15?$(this).find(".qs-content").html().substring(0,15)+"...":$(this).find(".qs-content").html();e+='<option class="choice-quote-option" value="'+$(this).find(".question-id").attr("absolute_id")+'">'+$(this).find(".question-id").html()+" "+n+"<\/option>"}});e+="<\/select>  的答案<\/label><\/li>";break;default:e+='<li><label><input type="checkbox" name="question-required" class="question-required no-required"/>  该题可跳过不答<\/label><\/li>'}return(e+='<li style="margin-top: 20px"><label>标题引用 <select class="title-quote-select" style="height: 30px;line-height: 30px;font-size: 12px;margin: 0 5px;"><option class="title-quote-option" value="0">请选择来源题目<\/option>',$(n).parents(".topic-type-content").prevAll(".topic-type-content").length>0&&$(n).parents(".topic-type-content").prevAll(".topic-type-content").each(function(){if(inArray($(this).find(".question-title").attr("type"),["1","2","6","7","8"])){var n=$(this).find(".qs-content").html().length>15?$(this).find(".qs-content").html().substring(0,15)+"...":$(this).find(".qs-content").html();e+='<option class="title-quote-option" value='+$(this).find(".question-id").attr("index")+">"+$(this).find(".question-id").html()+" "+n+"<\/option>"}}),e+='<\/select>  的答案<span class="title-quote-button">引用<\/span><\/label><\/li><textarea class="title-quote-text" id="title-quote-text" style="width: 436px;resize: none;height: 94px;margin-top: 5px">',e+=$(n).parents(".topic-type-content").find(".qs-content").html(),e+="<\/textarea>",e+='<\/ul><div style="margin-left: 16px"><span class="required handle-area-error"><\/span><\/div>',o.find(".handle-dialog-content").html(e),"Y"==$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("question-required")?$(".question-required").attr("checked",!1):$(".question-required").attr("checked",!0),"8"==t||"15"==t)&&(s=$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("min"),""!==s&&"undefined"!==s&&null!==s&&void 0!==s&&$(".min-checkbox").val(s),h=$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("max"),(""!==h&&"undefined"!==h&&null!==h&&void 0!==h&&$(".max-checkbox").val(h),"8"==t)&&(c=$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("exclusive-options"),""!==c&&"undefined"!==c&&null!==c&&void 0!==c&&w(c))),("6"==t||"7"==t||"8"==t)&&(l=$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("choice-quote"),""!==l&&"undefined"!==l&&null!==l&&void 0!==l&&o.find(".choice-quote-select").val(l)),v=getQuoteIndex($(n).parents(".topic-type-content").find(".qs-content").html()),v&&o.find(".title-quote-select").val(v[0]),"Confirm"!=u&&(null===u?o.find("#survey-confirm-y").hide():o.find("#survey-confirm-y").val(u)),"Cancel"!=f&&(null===f?o.find("#survey-confirm-n").hide():o.find("#survey-confirm-n").val(f)),o.find("#survey-confirm-y").click(function(){var i=r-1,u=!0,s=$(".min-checkbox").val(),f=$(".max-checkbox").val(),c,h,e;if(($(".topic-type-content:eq("+i+")").find(".question-title").find(".question-id").attr({min:""}),$(".topic-type-content:eq("+i+")").find(".question-title").find(".question-id").attr({max:""}),"8"===t||"15"==t)&&(($(".question-required").is(":checked")&&""!==s||$(".question-required").is(":checked")&&""!==f)&&($(".handle-area-error").html("该题是非必答题，不应设置最多最少选项"),u=!1),""!==s&&(isNaN(s)?($(".handle-area-error").html("请填写数字"),u=!1):1>s&&($(".handle-area-error").html("不能填写0或负数"),u=!1),u&&$(".topic-type-content:eq("+i+")").find(".question-title").find(".question-id").attr({min:$(".min-checkbox").val()})),c=$(".topic-type-content:eq("+i+")").find(".choice").length,""!==f&&(isNaN(f)?($(".handle-area-error").html("请填写数字"),u=!1):1>f?($(".handle-area-error").html("不能填写0或负数"),u=!1):f>c?($(".handle-area-error").html("最多选择数不能超过选项数量"),u=!1):f<$(".min-checkbox").val()&&($(".handle-area-error").html("最多选择数不能小于最少选择数量"),u=!1),u&&$(".topic-type-content:eq("+i+")").find(".question-title").find(".question-id").attr({max:$(".max-checkbox").val()}))),h=getQuoteIndex($("#title-quote-text").val()),h&&(checkIndexes(h)||($(".handle-area-error").html("不能引用矩阵题"),u=!1)),u){if($(".type-change").is(":checked"))switch(t){case"6":$(".topic-type-content:eq("+i+")").find(".question-title").attr({type:"8",name:"checkbox-question"});$(".topic-type-content:eq("+i+")").find(".choice").each(function(){$(this).find('input[name="radio"]').attr({type:"checkbox",name:"checkbox"})});break;case"14":$(".topic-type-content:eq("+i+")").find(".question-title").attr({type:"15",name:"checkbox-question"});$(".topic-type-content:eq("+i+")").find(".choice").each(function(){var n=$(this).attr("class"),t=n.replace(/radio/g,"checkbox");$(this).attr("class",t);$(this).find('input[name="radio"]').attr({type:"checkbox",name:"checkbox"});$(this).find("[class*='radio']").each(function(){var n=$(this).attr("class"),t=n.replace(/radio/g,"checkbox");$(this).attr("class",t)})});break;case"8":$(".topic-type-content:eq("+i+")").find(".question-title").attr({type:"6",name:"radio-question"});$(".topic-type-content:eq("+i+")").find(".exclusive-option-tip").remove();$(".topic-type-content:eq("+i+")").find(".choice").each(function(){$(this).find('input[name="checkbox"]').attr({type:"radio",name:"radio"})});break;case"15":$(".topic-type-content:eq("+i+")").find(".question-title").attr({type:"14",name:"radio-question"});$(".topic-type-content:eq("+i+")").find(".exclusive-option-tip").remove();$(".topic-type-content:eq("+i+")").find(".choice").each(function(){var n=$(this).attr("class"),t=n.replace(/checkbox/g,"radio");$(this).attr("class",t);$(this).find('input[name="checkbox"]').attr({type:"radio",name:"radio"});$(this).find("[class*='checkbox']").each(function(){var n=$(this).attr("class"),t=n.replace(/checkbox/g,"radio");$(this).attr("class",t)})})}$(".question-required").is(":checked")?($(".topic-type-content:eq("+i+")").find(".question-id").attr("question-required","N"),$(".topic-type-content:eq("+i+")").find(".required").remove()):($(".topic-type-content:eq("+i+")").find(".question-id").attr("question-required","Y"),0==$(".topic-type-content:eq("+i+")").find(".required").length&&$(".topic-type-content:eq("+i+")").find(".question-id").before('<span class="required">*<\/span>'));"0"!==$(".choice-quote-select").val()?$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("choice-quote",$(".choice-quote-select").val()):$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("choice-quote","0");h?($(n).parents(".topic-type-content").find(".qs-content").html($("#title-quote-text").val()),$(".topic-type-content:eq("+i+")").find(".question-id").attr("title-quote","Y")):$(".topic-type-content:eq("+i+")").find(".question-id").attr("title-quote","N");e=[];$(".exclusive-choice-select").each(function(){var n=$(this).val();"0"!==n&&-1==$.inArray(n,e)&&e.push(n)});e.length>0?$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("exclusive-options",e.join(",")):$(n).parents(".operate").siblings(".question-title").find(".question-id").attr("exclusive-options","");edit.updateQuestionType();edit.showExclusiveOptions();edit.updateByChoiceQuote();edit.saveSurvey();o.remove();a.resolve()}}),o.find(".title-quote-button").click(function(){var n=o.find(".title-quote-select").val();0!==parseInt(n,10)&&p(document.getElementById("title-quote-text"),"[Q"+n+"]")}),o.on("click",".exclusive-delete-button",function(){$(this).parent().parent().remove()}),o.find(".exclusive-add-button").click(function(){y()}),o.find("#survey-confirm-n").click(function(){o.remove();a.reject()}),o.find(".close").click(function(){o.remove();a.reject()}),a.promise()}});surveyTool=function(){function n(n,t,i,r){$.post(basePath+"survey/home/createSurveyActionLog",{name:t,type:i,value:r,page_name:n,page_uuid:window.page_uuid},function(){})}return{createSurveyActionLog:n}}();